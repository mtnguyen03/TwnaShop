S
QD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\ShopApi\global_using.csÍ
LD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\ShopApi\Program.cs
	namespace 	
ShopApi
 
{ 
public 

class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{ 	
var 
builder 
= 
WebApplication (
.( )
CreateBuilder) 6
(6 7
args7 ;
); <
;< =
builder 
. 
Services 
. 
AddControllers +
(+ ,
), -
. 
AddJsonOptions !
(! "
options" )
=>* ,
{ 
options 
. !
JsonSerializerOptions 3
.3 4
ReferenceHandler4 D
=E F
SystemG M
.M N
TextN R
.R S
JsonS W
.W X
SerializationX e
.e f
ReferenceHandlerf v
.v w
Preservew 
;	 €
} 
) 
; 
builder 
. 
Services 
. #
AddEndpointsApiExplorer 4
(4 5
)5 6
;6 7
builder 
. 
Services 
. 
AddSwaggerGen *
(* +
)+ ,
.# $
AddCors$ +
(+ ,
), -
.# $#
AddControllersWithViews$ ;
(; <
)< =
.# $
AddNewtonsoftJson$ 5
(5 6
)6 7
.# $2
&AddXmlDataContractSerializerFormatters$ J
(J K
)K L
;L M
builder 
. 
Services 
. 
	AddScoped &
<& '
ICommentRepository' 9
,9 :
CommentRepository; L
>L M
(M N
)N O
;O P
var 
app 
= 
builder 
. 
Build #
(# $
)$ %
;% &
if 
( 
app 
. 
Environment 
.  
IsDevelopment  -
(- .
). /
)/ 0
{ 
app   
.   

UseSwagger   
(   
)    
;    !
app!! 
.!! 
UseSwaggerUI!!  
(!!  !
)!!! "
;!!" #
}"" 
app$$ 
.$$ 
UseHttpsRedirection$$ #
($$# $
)$$$ %
;$$% &
app&& 
.&& 
UseAuthorization&&  
(&&  !
)&&! "
;&&" #
app(( 
.(( 
UseCors(( 
((( 
builder(( 
=>((  "
{)) 
builder** 
.** 
AllowAnyOrigin** &
(**& '
)**' (
.++ 
AllowAnyMethod++ &
(++& '
)++' (
.,, 
AllowAnyHeader,, &
(,,& '
),,' (
;,,( )
}-- 
)-- 
;-- 
app// 
.// 
MapControllers// 
(// 
)//  
;//  !
app11 
.11 
Run11 
(11 
)11 
;11 
}22 	
}33 
}44 Ê8
cD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\ShopApi\Controllers\CommentsController.cs
	namespace 	
ShopApi
 
. 
Controllers 
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
CommentsController #
(# $
ICommentRepository$ 6
_commentRepository7 I
)I J
:K L
ControllerBaseM [
{ 
[		 	
HttpGet			 
]		 
public

 
async

 
Task

 
<

 
IActionResult

 '
>

' (
GetComments

) 4
(

4 5
)

5 6
{ 	
var 
comments 
= 
await  
_commentRepository! 3
.3 4'
GetCommentsByProductIdAsync4 O
(O P
$numP Q
)Q R
;R S
return 
Ok 
( 
comments 
) 
;  
} 	
[ 	
HttpGet	 
( 
$str 
) 
]  
public 
async 
Task 
< 
IActionResult '
>' (
	GetReplys) 2
(2 3
int3 6
id7 9
)9 :
{ 	
var 
comments 
= 
await  
_commentRepository! 3
.3 4(
GetCommentsByProductIdAsync24 P
(P Q
$numQ R
,R S
idS U
)U V
;V W
return 
Ok 
( 
comments 
) 
;  
} 	
[ 	
HttpPost	 
] 
public 
async 
Task 
< 
IActionResult '
>' (

AddComment) 3
(3 4
[4 5
FromBody5 =
]= >
Comment? F
commentG N
)N O
{ 	
if 
( 
! 

ModelState 
. 
IsValid #
)# $
{ 
return 

BadRequest !
(! "
false" '
)' (
;( )
} 
var   

newComment   
=   
new    
Comment  ! (
{!! 
UserId"" 
="" 
comment""  
.""  !
UserId""! '
,""' (
	ProductId## 
=## 
comment## #
.### $
	ProductId##$ -
,##- .
CommentText$$ 
=$$ 
comment$$ %
.$$% &
CommentText$$& 1
,$$1 2
Rate%% 
=%% 
comment%% 
.%% 
Rate%% #
,%%# $
	CreatedAt&& 
=&& 
DateTime&& $
.&&$ %
UtcNow&&% +
}'' 
;'' 
var** 
addedComment** 
=** 
await** $
_commentRepository**% 7
.**7 8
AddCommentAsync**8 G
(**G H

newComment**H R
)**R S
;**S T
if-- 
(-- 
addedComment-- 
==-- 
null--  $
)--$ %
{.. 
return00 

BadRequest00 !
(00! "
false00" '
)00' (
;00( )
}11 
return33 
Ok33 
(33 
true33 
)33 
;33 
}44 	
[99 	

HttpDelete99	 
(99 
$str99 
)99 
]99 
public:: 
async:: 
Task:: 
<:: 
IActionResult:: '
>::' (
DeleteComment::) 6
(::6 7
int::7 :
id::; =
)::= >
{;; 	
var<< 
comment<< 
=<< 
await<< 
_commentRepository<<  2
.<<2 3
GetCommentByIdAsync<<3 F
(<<F G
id<<G I
)<<I J
;<<J K
if== 
(== 
comment== 
==== 
null== 
)==  
{>> 
return?? 
NotFound?? 
(??  
new??  #
{??$ %
message??& -
=??. /
$str??0 D
}??E F
)??F G
;??G H
}@@ 
awaitBB 
_commentRepositoryBB $
.BB$ %
DeleteCommentAsyncBB% 7
(BB7 8
idBB8 :
)BB: ;
;BB; <
returnCC 
OkCC 
(CC 
newCC 
{CC 
messageCC #
=CC$ %
$strCC& E
}CCF G
)CCG H
;CCH I
}DD 	
[GG 	
	HttpPatchGG	 
(GG 
$strGG 
)GG 
]GG 
publicHH 
asyncHH 
TaskHH 
<HH 
IActionResultHH '
>HH' (
UpdateCommentHH) 6
(HH6 7
intHH7 :
idHH; =
,HH= >
[HH? @
FromBodyHH@ H
]HHH I
JsonPatchDocumentHHJ [
<HH[ \

CommentDtoHH\ f
>HHf g
patchDocHHh p
)HHp q
{II 	
ifJJ 
(JJ 
patchDocJJ 
==JJ 
nullJJ  
)JJ  !
{KK 
returnLL 

BadRequestLL !
(LL! "
$strLL" ;
)LL; <
;LL< =
}MM 
tryOO 
{PP 
varQQ 

commentDtoQQ 
=QQ  
newQQ! $

CommentDtoQQ% /
(QQ/ 0
)QQ0 1
;QQ1 2
patchDocRR 
.RR 
ApplyToRR  
(RR  !

commentDtoRR! +
,RR+ ,

ModelStateRR- 7
)RR7 8
;RR8 9
ifUU 
(UU 
!UU 

ModelStateUU 
.UU  
IsValidUU  '
)UU' (
{VV 
returnWW 

BadRequestWW %
(WW% &

ModelStateWW& 0
)WW0 1
;WW1 2
}XX 
await[[ 
_commentRepository[[ (
.[[( )
UpdateCommentAsync[[) ;
([[; <
id[[< >
,[[> ?

commentDto[[@ J
)[[J K
;[[K L
return\\ 
	NoContent\\  
(\\  !
)\\! "
;\\" #
}]] 
catch^^ 
(^^  
KeyNotFoundException^^ '
)^^' (
{__ 
return`` 
NotFound`` 
(``  
new``  #
{``$ %
message``& -
=``. /
$str``0 D
}``E F
)``F G
;``G H
}aa 
catchbb 
(bb 
	Exceptionbb 
exbb 
)bb  
{cc 
returndd 

StatusCodedd !
(dd! "
$numdd" %
,dd% &
newdd' *
{dd+ ,
messagedd- 4
=dd5 6
exdd7 9
.dd9 :
Messagedd: A
}ddB C
)ddC D
;ddD E
}ee 
}ff 	
}jj 
}kk 