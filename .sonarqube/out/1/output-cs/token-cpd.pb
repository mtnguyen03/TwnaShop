¥3
QD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\DataAcess\ProductDAO.cs
	namespace 	
	DataAcess
 
{ 
public 

class 

ProductDAO 
{ 
private 
static 

ProductDAO !
instance" *
;* +
public 
static 

ProductDAO  
Instance! )
{ 	
get		 
{

 
if 
( 
instance 
== 
null  $
)$ %
{ 
instance 
= 
new "

ProductDAO# -
(- .
). /
;/ 0
} 
return 
instance 
;  
} 
} 	
public 
async 
Task 
< 
IEnumerable %
<% &
Product& -
>- .
>. /
GetProducts0 ;
(; <
)< =
{ 	
var 
_context 
= 
new 
ShopDbContext ,
(, -
)- .
;. /
var 
list 
= 
await 
_context %
.% &
Products& .
.. /
AsNoTracking/ ;
(; <
)< =
.= >
ToListAsync> I
(I J
)J K
;K L
return 
list 
; 
} 	
public 
async 
Task 
< 
int 
> #
GetTotalProductQuantity 6
(6 7
)7 8
{ 	
using 
( 
var 
_context 
=  !
new" %
ShopDbContext& 3
(3 4
)4 5
)5 6
{   
var!! 
products!! 
=!! 
await!! $
_context!!% -
.!!- .
Products!!. 6
.!!6 7
AsNoTracking!!7 C
(!!C D
)!!D E
.!!E F
Where!!F K
(!!K L
p!!L M
=>!!N P
p!!Q R
.!!R S
	ProductId!!S \
==!!] _
$num!!` a
)!!a b
.!!b c
ToListAsync!!c n
(!!n o
)!!o p
;!!p q
var"" 
totalQuantity"" !
=""" #
products""$ ,
."", -
Sum""- 0
(""0 1
p""1 2
=>""3 5
p""6 7
.""7 8
QuantityPerUnit""8 G
)""G H
;""H I
return$$ 
totalQuantity$$ $
;$$$ %
}%% 
}&& 	
public(( 

IQueryable(( 
<(( 
Product(( !
>((! ""
GetProductsAsQueryable((# 9
(((9 :
)((: ;
{)) 	
var** 
_context** 
=** 
new** 
ShopDbContext** ,
(**, -
)**- .
;**. /
return++ 
_context++ 
.++ 
Products++ $
.++$ %
AsQueryable++% 0
(++0 1
)++1 2
.++2 3
AsNoTracking++3 ?
(++? @
)++@ A
;++A B
},, 	
public.. 
async.. 
Task.. 
<.. 
Product.. !
>..! "
GetProductById..# 1
(..1 2
int..2 5
?..5 6
id..7 9
)..9 :
{// 	
var00 
_context00 
=00 
new00 
ShopDbContext00 ,
(00, -
)00- .
;00. /
var11 
Product11 
=11 
await11 
_context11  (
.11( )
Products11) 1
.111 2
AsNoTracking112 >
(11> ?
)11? @
.11@ A 
SingleOrDefaultAsync11A U
(11U V
s11V W
=>11X Z
s11[ \
.11\ ]
	ProductId11] f
==11g i
id11j l
)11l m
;11m n
return22 
Product22 
;22 
}33 	
public88 
async88 
Task88 
Add88 
(88 
Product88 %
pro88& )
)88) *
{99 	
var:: 
_db:: 
=:: 
new:: 
ShopDbContext:: '
(::' (
)::( )
;::) *
_db;; 
.;; 
Products;; 
.;; 
Add;; 
(;; 
pro;;  
);;  !
;;;! "
await<< 
_db<< 
.<< 
SaveChangesAsync<< &
(<<& '
)<<' (
;<<( )
}== 	
public?? 
async?? 
Task?? 
Update??  
(??  !
Product??! (
pro??) ,
)??, -
{@@ 	
varAA 
_dbAA 
=AA 
newAA 
ShopDbContextAA '
(AA' (
)AA( )
;AA) *
varBB 
oBB 
=BB 
awaitBB 
GetProductByIdBB (
(BB( )
proBB) ,
.BB, -
	ProductIdBB- 6
)BB6 7
;BB7 8
ifCC 
(CC 
oCC 
!=CC 
nullCC 
)CC 
{DD 
_dbEE 
.EE 
ProductsEE 
.EE 
UpdateEE #
(EE# $
proEE$ '
)EE' (
;EE( )
awaitFF 
_dbFF 
.FF 
SaveChangesAsyncFF *
(FF* +
)FF+ ,
;FF, -
}GG 
}II 	
publicKK 
asyncKK 
TaskKK 
DeleteKK  
(KK  !
ProductKK! (
proKK) ,
)KK, -
{LL 	
varMM 
_dbMM 
=MM 
newMM 
ShopDbContextMM '
(MM' (
)MM( )
;MM) *
varNN 
oNN 
=NN 
awaitNN 
GetProductByIdNN (
(NN( )
proNN) ,
.NN, -
	ProductIdNN- 6
)NN6 7
;NN7 8
ifOO 
(OO 
oOO 
!=OO 
nullOO 
)OO 
{PP 
_dbQQ 
.QQ 
ProductsQQ 
.QQ 
RemoveQQ #
(QQ# $
proQQ$ '
)QQ' (
;QQ( )
awaitRR 
_dbRR 
.RR 
SaveChangesAsyncRR *
(RR* +
)RR+ ,
;RR, -
}SS 
}UU 	
}WW 
}XX ±"
UD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\DataAcess\OrderDetailDAO.cs
	namespace 	

DataAccess
 
{ 
public 

class 
OrderDetailDAO 
{ 
private 
static 
OrderDetailDAO %
instance& .
;. /
private 
readonly 
ShopDbContext &
_context' /
;/ 0
private 
OrderDetailDAO 
( 
)  
{		 	
_context

 
=

 
new

 
ShopDbContext

 (
(

( )
)

) *
;

* +
} 	
public 
static 
OrderDetailDAO $
Instance% -
{ 	
get 
{ 
if 
( 
instance 
== 
null  $
)$ %
{ 
instance 
= 
new "
OrderDetailDAO# 1
(1 2
)2 3
;3 4
} 
return 
instance 
;  
} 
} 	
public 
async 
Task 
< 
IEnumerable %
<% &
OrderDetail& 1
>1 2
>2 3
GetOrderDetails4 C
(C D
)D E
{ 	
return 
await 
_context !
.! "
OrderDetails" .
.! "
Include" )
() *
od* ,
=>- /
od0 2
.2 3
Product3 :
): ;
.! "
Include" )
() *
od* ,
=>- /
od0 2
.2 3
Order3 8
)8 9
.! "
ToListAsync" -
(- .
). /
;/ 0
} 	
public!! 
async!! 
Task!! 
<!! 
OrderDetail!! %
>!!% &
GetOrderDetailByIds!!' :
(!!: ;
int!!; >
orderId!!? F
,!!F G
int!!H K
	productId!!L U
)!!U V
{"" 	
return## 
await## 
_context## !
.##! "
OrderDetails##" .
.$$! "
Include$$" )
($$) *
od$$* ,
=>$$- /
od$$0 2
.$$2 3
Product$$3 :
)$$: ;
.%%! "
Include%%" )
(%%) *
od%%* ,
=>%%- /
od%%0 2
.%%2 3
Order%%3 8
)%%8 9
.&&! " 
SingleOrDefaultAsync&&" 6
(&&6 7
od&&7 9
=>&&: <
od&&= ?
.&&? @
OrderId&&@ G
==&&H J
orderId&&K R
&&&&S U
od&&V X
.&&X Y
	ProductId&&Y b
==&&c e
	productId&&f o
)&&o p
;&&p q
}'' 	
public)) 
async)) 
Task)) 
Add)) 
()) 
OrderDetail)) )
orderDetail))* 5
)))5 6
{** 	
_context++ 
.++ 
OrderDetails++ !
.++! "
Add++" %
(++% &
orderDetail++& 1
)++1 2
;++2 3
await,, 
_context,, 
.,, 
SaveChangesAsync,, +
(,,+ ,
),,, -
;,,- .
}-- 	
public// 
async// 
Task// 
Update//  
(//  !
OrderDetail//! ,
orderDetail//- 8
)//8 9
{00 	
_context11 
.11 
OrderDetails11 !
.11! "
Update11" (
(11( )
orderDetail11) 4
)114 5
;115 6
await22 
_context22 
.22 
SaveChangesAsync22 +
(22+ ,
)22, -
;22- .
}33 	
public55 
async55 
Task55 
Delete55  
(55  !
OrderDetail55! ,
orderDetail55- 8
)558 9
{66 	
_context77 
.77 
OrderDetails77 !
.77! "
Remove77" (
(77( )
orderDetail77) 4
)774 5
;775 6
await88 
_context88 
.88 
SaveChangesAsync88 +
(88+ ,
)88, -
;88- .
}99 	
}:: 
};; ¡8
OD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\DataAcess\OrderDAO.cs
	namespace 	
	DataAcess
 
{ 
public 

class 
OrderDAO 
{ 
private 
static 
OrderDAO 
instance  (
;( )
public 
static 
OrderDAO 
Instance '
{ 	
get 
{		 
if

 
(

 
instance

 
==

 
null

  $
)

$ %
{ 
instance 
= 
new "
OrderDAO# +
(+ ,
), -
;- .
} 
return 
instance 
;  
} 
} 	
public 
async 
Task 
< 
IEnumerable %
<% &
Order& +
>+ ,
>, -
	GetOrders. 7
(7 8
)8 9
{ 	
var 
_context 
= 
new 
ShopDbContext ,
(, -
)- .
;. /
var 
list 
= 
await 
_context %
.% &
Orders& ,
., -
Include- 4
(4 5
o5 6
=>7 9
o: ;
.; <
OrderDetails< H
)H I
.I J
OrderByJ Q
(Q R
oR S
=>T V
oW X
.X Y
OrderIdY `
)` a
.a b
ToListAsyncb m
(m n
)n o
;o p
return 
list 
; 
} 	
public 
async 
Task 
< 
IEnumerable %
<% &
OrderReportDto& 4
>4 5
>5 6
GetOrdersDto7 C
(C D
)D E
{ 	
var 
_context 
= 
new 
ShopDbContext ,
(, -
)- .
;. /
var 
list 
= 
await 
_context %
.% &
Orders& ,
. 
Join 
( 
_context   
.   
Accounts   %
,  % &
order!! 
=>!! 
order!! "
.!!" #

CustomerId!!# -
,!!- .
account"" 
=>"" 
account"" &
.""& '
	AccountID""' 0
,""0 1
(## 
order## 
,## 
account## #
)### $
=>##% '
new##( +
OrderReportDto##, :
{$$ 

CustomerId%% "
=%%# $
order%%% *
.%%* +

CustomerId%%+ 5
,%%5 6
CustomerName&& $
=&&% &
account&&' .
.&&. /
FullName&&/ 7
,&&7 8
	OrderDate'' !
=''" #
order''$ )
.'') *
	OrderDate''* 3
,''3 4
OrderId(( 
=((  !
order((" '
.((' (
OrderId((( /
,((/ 0
ShippedDate)) #
=))$ %
order))& +
.))+ ,
ShippedDate)), 7
,))7 8
Freight** 
=**  !
order**" '
.**' (
Freight**( /
,**/ 0
ShipAddress++ #
=++$ %
order++& +
.+++ ,
ShipAddress++, 7
,++7 8
Status,, 
=,,  
order,,! &
.,,& '
Status,,' -
}-- 
)-- 
.-- 
OrderByDescending-- (
(--( )
o--) *
=>--+ -
o--. /
.--/ 0
OrderId--0 7
)--7 8
... 
ToListAsync.. 
(.. 
).. 
;.. 
return00 
list00 
;00 
}11 	
public44 
async44 
Task44 
<44 
Order44 
>44  
GetOrderById44! -
(44- .
int44. 1
?441 2
id443 5
)445 6
{55 	
var66 
_context66 
=66 
new66 
ShopDbContext66 ,
(66, -
)66- .
;66. /
var77 
order77 
=77 
await77 
_context77 &
.77& '
Orders77' -
.77- . 
SingleOrDefaultAsync77. B
(77B C
o77C D
=>77E G
o77H I
.77I J
OrderId77J Q
==77R T
id77U W
)77W X
;77X Y
return88 
order88 
;88 
}99 	
public;; 
async;; 
Task;; 
Add;; 
(;; 
Order;; #
order;;$ )
);;) *
{<< 	
var== 
_db== 
=== 
new== 
ShopDbContext== '
(==' (
)==( )
;==) *
_db>> 
.>> 
Orders>> 
.>> 
Add>> 
(>> 
order>>  
)>>  !
;>>! "
await?? 
_db?? 
.?? 
SaveChangesAsync?? &
(??& '
)??' (
;??( )
}@@ 	
publicBB 
asyncBB 
TaskBB 
UpdateBB  
(BB  !
OrderBB! &
orderBB' ,
)BB, -
{CC 	
varDD 
_dbDD 
=DD 
newDD 
ShopDbContextDD '
(DD' (
)DD( )
;DD) *
varEE 
existingOrderEE 
=EE 
awaitEE  %
GetOrderByIdEE& 2
(EE2 3
orderEE3 8
.EE8 9
OrderIdEE9 @
)EE@ A
;EEA B
ifFF 
(FF 
existingOrderFF 
!=FF  
nullFF! %
)FF% &
{GG 
_dbHH 
.HH 
OrdersHH 
.HH 
UpdateHH !
(HH! "
orderHH" '
)HH' (
;HH( )
awaitII 
_dbII 
.II 
SaveChangesAsyncII *
(II* +
)II+ ,
;II, -
}JJ 
}KK 	
publicMM 
asyncMM 
TaskMM 
DeleteMM  
(MM  !
OrderMM! &
orderMM' ,
)MM, -
{NN 	
varOO 
_dbOO 
=OO 
newOO 
ShopDbContextOO '
(OO' (
)OO( )
;OO) *
varPP 
existingOrderPP 
=PP 
awaitPP  %
GetOrderByIdPP& 2
(PP2 3
orderPP3 8
.PP8 9
OrderIdPP9 @
)PP@ A
;PPA B
ifQQ 
(QQ 
existingOrderQQ 
!=QQ  
nullQQ! %
)QQ% &
{RR 
_dbSS 
.SS 
OrdersSS 
.SS 
RemoveSS !
(SS! "
orderSS" '
)SS' (
;SS( )
awaitTT 
_dbTT 
.TT 
SaveChangesAsyncTT *
(TT* +
)TT+ ,
;TT, -
}UU 
}VV 	
}WW 
}XX 6
VD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\DataAcess\NotificationDAO.cs
	namespace 	

DataAccess
 
{ 
public 

class 
NotificationDAO  
{ 
private 
static 
NotificationDAO &
_context' /
;/ 0
public 
static 
NotificationDAO %
Instance& .
{ 	
get 
{		 
if

 
(

 
_context

 
==

 
null

  $
)

$ %
{ 
_context 
= 
new "
NotificationDAO# 2
(2 3
)3 4
;4 5
} 
return 
_context 
;  
} 
} 	
public 
async 
Task 
< 
IEnumerable %
<% &
Notification& 2
>2 3
>3 4
GetNotificationAll5 G
(G H
)H I
{ 	
using 
( 
var 
_context 
=  !
new" %
ShopDbContext& 3
(3 4
)4 5
)5 6
{ 
var 
list 
= 
await  
_context! )
.) *
Notifications* 7
.7 8
ToListAsync8 C
(C D
)D E
;E F
return 
list 
; 
} 
} 	
public 
async 
Task 
< 
IEnumerable %
<% &
Notification& 2
>2 3
>3 4)
GetNotificationsByUserIdAsync5 R
(R S
intS V
?V W
userIdX ^
)^ _
{ 	
using 
( 
var 
_context 
=  !
new" %
ShopDbContext& 3
(3 4
)4 5
)5 6
{   
var!! 
notifications!! !
=!!" #
await!!$ )
_context!!* 2
.!!2 3
Notifications!!3 @
.""2 3
Where""3 8
(""8 9
n""9 :
=>""; =
n""> ?
.""? @
UserID""@ F
==""G I
userId""J P
)""P Q
.""Q R
OrderByDescending""R c
(""c d
o""d e
=>""f h
o""i j
.""j k
NotificationDate""k {
)""{ |
.##2 3
ToListAsync##3 >
(##> ?
)##? @
;##@ A
return$$ 
notifications$$ $
;$$$ %
}%% 
}&& 	
public)) 
async)) 
Task)) 
<)) 
int)) 
>)) %
GetTotalNotiQuantityAsync)) 8
())8 9
int))9 <
?))< =
userId))> D
)))D E
{** 	
using++ 
(++ 
var++ 
_context++ 
=++  !
new++" %
ShopDbContext++& 3
(++3 4
)++4 5
)++5 6
{,, 
var-- 
totalQuantity-- !
=--" #
await--$ )
_context--* 2
.--2 3
Notifications--3 @
...2 3
Where..3 8
(..8 9
n..9 :
=>..; =
n..> ?
...? @
UserID..@ F
==..G I
userId..J P
)..P Q
.//2 3

CountAsync//3 =
(//= >
)//> ?
;//? @
return00 
totalQuantity00 $
;00$ %
}11 
}22 	
public55 
async55 
Task55 
Add55 
(55 
Notification55 *
pro55+ .
)55. /
{66 	
using77 
(77 
var77 
_db77 
=77 
new77  
ShopDbContext77! .
(77. /
)77/ 0
)770 1
{88 
_db99 
.99 
Notifications99 !
.99! "
Add99" %
(99% &
pro99& )
)99) *
;99* +
await:: 
_db:: 
.:: 
SaveChangesAsync:: *
(::* +
)::+ ,
;::, -
};; 
}<< 	
public== 
async== 
Task== 
Delete==  
(==  !
int==! $
notificationId==% 3
)==3 4
{>> 	
using@@ 
(@@ 
var@@ 
_db@@ 
=@@ 
new@@  
ShopDbContext@@! .
(@@. /
)@@/ 0
)@@0 1
{AA 
varCC 
notificationCC  
=CC! "
awaitCC# (
_dbCC) ,
.CC, -
NotificationsCC- :
.CC: ;
FirstOrDefaultAsyncCC; N
(CCN O
nCCO P
=>CCQ S
nCCT U
.CCU V
NotificationIDCCV d
==CCe g
notificationIdCCh v
)CCv w
;CCw x
ifFF 
(FF 
notificationFF  
!=FF! #
nullFF$ (
)FF( )
{GG 
_dbHH 
.HH 
NotificationsHH %
.HH% &
RemoveHH& ,
(HH, -
notificationHH- 9
)HH9 :
;HH: ;
awaitII 
_dbII 
.II 
SaveChangesAsyncII .
(II. /
)II/ 0
;II0 1
}JJ 
}LL 
}MM 	
publicQQ 
asyncQQ 
TaskQQ 
<QQ 
boolQQ 
>QQ 
	DeleteAllQQ  )
(QQ) *
intQQ* -
?QQ- .
userIdQQ/ 5
)QQ5 6
{RR 	
usingSS 
(SS 
varSS 
_dbSS 
=SS 
newSS  
ShopDbContextSS! .
(SS. /
)SS/ 0
)SS0 1
{TT 
varUU 
notificationsUU !
=UU" #
awaitUU$ )
_dbUU* -
.UU- .
NotificationsUU. ;
.VV- .
WhereVV. 3
(VV3 4
nVV4 5
=>VV6 8
nVV9 :
.VV: ;
UserIDVV; A
==VVB D
userIdVVE K
)VVK L
.WW- .
ToListAsyncWW. 9
(WW9 :
)WW: ;
;WW; <
ifXX 
(XX 
notificationsXX !
.XX! "
AnyXX" %
(XX% &
)XX& '
)XX' (
{YY 
_dbZZ 
.ZZ 
NotificationsZZ %
.ZZ% &
RemoveRangeZZ& 1
(ZZ1 2
notificationsZZ2 ?
)ZZ? @
;ZZ@ A
await[[ 
_db[[ 
.[[ 
SaveChangesAsync[[ .
([[. /
)[[/ 0
;[[0 1
return\\ 
true\\ 
;\\  
}]] 
}^^ 
return__ 
false__ 
;__ 
}`` 	
}aa 
}bb U
SD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\DataAcess\global_using.cs©
WD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\DataAcess\Dto\UserReplyDto.cs
	namespace 	
	DataAcess
 
. 
Dto 
{ 
public 

class 
UserReplyDto 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
int 
? 
UserId 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Photo 
{ 
get !
;! "
set# &
;& '
}( )
public		 
int		 
?		 
	ProductId		 
{		 
get		  #
;		# $
set		% (
;		( )
}		* +
public

 
string

 
Content

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
public 
int 
? 
UserReplyId 
{  !
get" %
;% &
set' *
;* +
}, -
public 
DateTime 
? 
	CreatedAt "
{# $
get% (
;( )
set* -
;- .
}/ 0
} 
} º
WD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\DataAcess\Dto\StatisticDto.cs
	namespace 	
	DataAcess
 
. 
Dto 
{ 
public 

class 
StatisticDto 
{ 
public 
decimal 
TotalRevenue #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
int 
TotalOrders 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
int 
SuccessfulOrders #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
int 
PendingOrders  
{! "
get# &
;& '
set( +
;+ ,
}- .
public		 
int		 
CancelledOrders		 "
{		# $
get		% (
;		( )
set		* -
;		- .
}		/ 0
public

 
int

 
ReturnedOrders

 !
{

" #
get

$ '
;

' (
set

) ,
;

, -
}

. /
public 
int 
DisputedOrders !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
int 
DangYeuCautra  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
int 
DangYeuCauGiaiQuyet &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
} 
} µ
YD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\DataAcess\Dto\OrderReportDto.cs
	namespace 	
	DataAcess
 
. 
Dto 
{ 
public 

class 
OrderReportDto 
{ 
public 
int 
OrderId 
{ 
get  
;  !
set" %
;% &
}' (
public 
int 
? 

CustomerId 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
DateTime 
	OrderDate !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
DateTime 
? 
ShippedDate $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public		 
decimal		 
?		 
Freight		 
{		  !
get		" %
;		% &
set		' *
;		* +
}		, -
public

 
string

 
ShipAddress

 !
{

" #
get

$ '
;

' (
set

) ,
;

, -
}

. /
public 
byte 
Status 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
CustomerName "
{# $
get& )
;) *
set+ .
;. /
}0 1
} 
} ¨
UD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\DataAcess\Dto\CommentDto.cs
	namespace 	
	DataAcess
 
. 
Dto 
{ 
public 

class 

CommentDto 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
? 
UserName 
{  !
get" %
;% &
set' *
;* +
}, -
public 
int 
? 
UserId 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
? 
Photo 
{ 
get "
;" #
set$ '
;' (
}) *
public		 
int		 
?		 
	ProductId		 
{		 
get		  #
;		# $
set		% (
;		( )
}		* +
public

 
string

 
?

 
CommentText

 "
{

# $
get

% (
;

( )
set

* -
;

- .
}

/ 0
[ 	
DataType	 
( 
DataType 
. 
DateTime #
)# $
]$ %
[ 	
Range	 
( 
$num 
, 
$num 
) 
] 
public 
int 
? 
Rate 
{ 
get 
; 
set  #
;# $
}% &
public 
DateTime 
? 
	CreatedAt "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
int 
? 
UserReplyId 
{  !
get" %
;% &
set' *
;* +
}, -
[ 	
DataType	 
( 
DataType 
. 
DateTime #
)# $
]$ %
public 
DateTime 
? 
	UpdatedAt "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
List 
< 
UserReplyDto  
>  !
?! "
UserReplies# .
{/ 0
get1 4
;4 5
set6 9
;9 :
}; <
} 
} Åw
QD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\DataAcess\CommentDao.cs
	namespace 	

DataAccess
 
{ 
public 

class 

CommentDao 
{ 
private 
static 

CommentDao !
	_instance" +
;+ ,
private 
readonly 
ShopDbContext &
_context' /
;/ 0
public		 
static		 

CommentDao		  
Instance		! )
{

 	
get 
{ 
if 
( 
	_instance 
==  
null! %
)% &
{ 
	_instance 
= 
new  #

CommentDao$ .
(. /
)/ 0
;0 1
} 
return 
	_instance  
;  !
} 
} 	
private 

CommentDao 
( 
) 
{ 	
_context 
= 
new 
ShopDbContext (
(( )
)) *
;* +
} 	
public 
async 
Task 
< 
IEnumerable %
<% &
Comment& -
>- .
>. /
GetAllCommentsAsync0 C
(C D
)D E
{ 	
return 
await 
_context !
.! "
Comments" *
. 
Include 
( 
c 
=> 
c 
.  
User  $
)$ %
. 
Include 
( 
c 
=> 
c 
.  
Product  '
)' (
. 
Include 
( 
c 
=> 
c 
.  
UserReplies  +
)+ ,
.   
ToListAsync   
(   
)   
;   
}!! 	
public## 
async## 
Task## 
<## 
Comment## !
?##! "
>##" #
GetCommentByIdAsync##$ 7
(##7 8
int##8 ;
id##< >
)##> ?
{$$ 	
return%% 
await%% 
_context%% !
.%%! "
Comments%%" *
.&& 
Include&& 
(&& 
c&& 
=>&& 
c&& 
.&&  
User&&  $
)&&$ %
.'' 
Include'' 
('' 
c'' 
=>'' 
c'' 
.''  
Product''  '
)''' (
.(( 
FirstOrDefaultAsync(( $
((($ %
c((% &
=>((' )
c((* +
.((+ ,
Id((, .
==((/ 1
id((2 4
)((4 5
;((5 6
})) 	
public++ 
async++ 
Task++ 
<++ 
IEnumerable++ %
<++% &

CommentDto++& 0
>++0 1
>++1 2'
GetCommentsByProductIdAsync++3 N
(++N O
int++O R
	productId++S \
)++\ ]
{,, 	
return-- 
await-- 
_context-- !
.--! "
Comments--" *
... 
Include.. 
(.. 
c.. 
=>.. 
c..  
...  !
User..! %
)..% &
.// 
Include// 
(// 
c// 
=>// 
c//  
.//  !
Product//! (
)//( )
.00 
Include00 
(00 
c00 
=>00 
c00  
.00  !
UserReplies00! ,
)00, -
.11 
Select11 
(11 
c11 
=>11 
new11 !

CommentDto11" ,
{22 
Id33 
=33 
c33 
.33 
Id33 
,33 
CommentText44  
=44! "
c44# $
.44$ %
CommentText44% 0
,440 1
UserName55 
=55 
c55  !
.55! "
User55" &
.55& '
FullName55' /
,55/ 0
UserId66 
=66 
c66 
.66  
User66  $
.66$ %
	AccountID66% .
,66. /
	ProductId77 
=77  
c77! "
.77" #
	ProductId77# ,
,77, -
UserReplyId88  
=88! "
c88# $
.88$ %
UserReplyId88% 0
,880 1
	CreatedAt99 
=99  
c99! "
.99" #
	CreatedAt99# ,
,99, -
	UpdatedAt:: 
=::  
c::! "
.::" #
	UpdatedAt::# ,
,::, -
Photo;; 
=;; 
c;; 
.;; 
User;; #
.;;# $
Photo;;$ )
,;;) *
Rate<< 
=<< 
c<< 
.<< 
Rate<< "
,<<" #
UserReplies==  
===! "
c==# $
.==$ %
UserReplies==% 0
.==0 1
Select==1 7
(==7 8
ur==8 :
=>==; =
new==> A
UserReplyDto==B N
{>> 
Id?? 
=?? 
ur??  
.??  !
Id??! #
,??# $
UserId@@ 
=@@  !
ur@@" $
.@@$ %
UserId@@% +
,@@+ ,
UserNameAA !
=AA" #
urAA$ &
.AA& '
UserAA' +
.AA+ ,
FullNameAA, 4
,AA4 5
PhotoBB 
=BB  
urBB! #
.BB# $
UserBB$ (
.BB( )
PhotoBB) .
,BB. /
	ProductIdCC "
=CC# $
urCC% '
.CC' (
	ProductIdCC( 1
,CC1 2
UserReplyIdDD $
=DD% &
urDD' )
.DD) *
UserReplyIdDD* 5
,DD5 6
	CreatedAtEE "
=EE# $
urEE% '
.EE' (
	CreatedAtEE( 1
,EE1 2
ContentFF  
=FF! "
urFF# %
.FF% &
CommentTextFF& 1
}GG 
)GG 
.GG 
ToListGG 
(GG 
)GG  
}HH 
)HH 
.II 
WhereII 
(II 
cII 
=>II 
cII 
.II 
RateII #
!=II$ &
nullII' +
)II+ ,
.II, -
OrderByDescendingII- >
(II> ?
cII? @
=>IIA C
cIID E
.IIE F
IdIIF H
)IIH I
.JJ 
ToListAsyncJJ 
(JJ 
)JJ 
;JJ  
}KK 	
publicMM 
asyncMM 
TaskMM 
<MM 
IEnumerableMM %
<MM% &

CommentDtoMM& 0
>MM0 1
>MM1 2(
GetCommentsByProductIdAsync2MM3 O
(MMO P
intMMP S
	productIdMMT ]
,MM] ^
intMM_ b
userCommentIdMMc p
)MMp q
{NN 	
returnOO 
awaitOO 
_contextOO !
.OO! "
CommentsOO" *
.PP 
IncludePP 
(PP 
cPP 
=>PP 
cPP  
.PP  !
UserPP! %
)PP% &
.QQ 
IncludeQQ 
(QQ 
cQQ 
=>QQ 
cQQ  
.QQ  !
ProductQQ! (
)QQ( )
.RR 
IncludeRR 
(RR 
cRR 
=>RR 
cRR  
.RR  !
UserRepliesRR! ,
)RR, -
.SS 
SelectSS 
(SS 
cSS 
=>SS 
newSS !

CommentDtoSS" ,
{TT 
IdUU 
=UU 
cUU 
.UU 
IdUU 
,UU 
CommentTextVV  
=VV! "
cVV# $
.VV$ %
CommentTextVV% 0
,VV0 1
UserNameWW 
=WW 
cWW  !
.WW! "
UserWW" &
.WW& '
FullNameWW' /
,WW/ 0
UserIdXX 
=XX 
cXX 
.XX  
UserXX  $
.XX$ %
	AccountIDXX% .
,XX. /
	ProductIdYY 
=YY  
cYY! "
.YY" #
	ProductIdYY# ,
,YY, -
UserReplyIdZZ  
=ZZ! "
cZZ# $
.ZZ$ %
UserReplyIdZZ% 0
,ZZ0 1
	CreatedAt[[ 
=[[  
c[[! "
.[[" #
	CreatedAt[[# ,
,[[, -
	UpdatedAt\\ 
=\\  
c\\! "
.\\" #
	UpdatedAt\\# ,
,\\, -
Photo]] 
=]] 
c]] 
.]] 
User]] #
.]]# $
Photo]]$ )
,]]) *
Rate^^ 
=^^ 
c^^ 
.^^ 
Rate^^ "
,^^" #
UserReplies__  
=__! "
c__# $
.__$ %
UserReplies__% 0
.__0 1
Select__1 7
(__7 8
ur__8 :
=>__; =
new__> A
UserReplyDto__B N
{`` 
Idaa 
=aa 
uraa  
.aa  !
Idaa! #
,aa# $
UserIdbb 
=bb  !
urbb" $
.bb$ %
UserIdbb% +
,bb+ ,
UserNamecc !
=cc" #
urcc$ &
.cc& '
Usercc' +
.cc+ ,
FullNamecc, 4
,cc4 5
Photodd 
=dd  
urdd! #
.dd# $
Userdd$ (
.dd( )
Photodd) .
,dd. /
	ProductIdee "
=ee# $
uree% '
.ee' (
	ProductIdee( 1
,ee1 2
UserReplyIdff $
=ff% &
urff' )
.ff) *
UserReplyIdff* 5
,ff5 6
	CreatedAtgg "
=gg# $
urgg% '
.gg' (
	CreatedAtgg( 1
,gg1 2
Contenthh  
=hh! "
urhh# %
.hh% &
CommentTexthh& 1
}ii 
)ii 
.ii 
ToListii 
(ii 
)ii  
}jj 
)jj 
.kk 
Wherekk 
(kk 
ckk 
=>kk 
ckk 
.kk 
Ratekk #
==kk$ &
nullkk' +
&&kk, .
ckk/ 0
.kk0 1
UserReplyIdkk1 <
==kk= ?
userCommentIdkk@ M
)kkM N
.ll 
ToListAsyncll 
(ll 
)ll 
;ll  
}mm 	
publicpp 
asyncpp 
Taskpp 
<pp 
Commentpp !
>pp! "
AddCommentAsyncpp# 2
(pp2 3
Commentpp3 :
commentpp; B
)ppB C
{qq 	
varss 
hasPurchasedss 
=ss 
awaitss 
_contextss %
.ss% &
Ordersss& ,
.tt 	
AnyAsynctt	 
(tt 
odtt 
=>tt 
odtt 
.tt 

CustomerIdtt %
==tt& (
commenttt) 0
.tt0 1
UserIdtt1 7
&&tt9 ;
odtt< >
.tt> ?
Statustt? E
!=ttF H
$numttI J
)ttJ K
;ttK L
ifvv 
(vv 
!vv 
hasPurchasedvv 
)vv 
{ww 
returnxx 
nullxx 
;xx 
}yy 
var|| 
existingReview|| 
=||  
await||! &
_context||' /
.||/ 0
Comments||0 8
.}} 
AnyAsync}} 
(}} 
c}} 
=>}} 
c}}  
.}}  !
UserId}}! '
==}}( *
comment}}+ 2
.}}2 3
UserId}}3 9
&&}}: <
c}}= >
.}}> ?
	ProductId}}? H
==}}I K
comment}}L S
.}}S T
	ProductId}}T ]
)}}] ^
;}}^ _
if 
( 
existingReview 
) 
{
 
return
 
null
 
;
 
}
 
_context
 
.
 
Comments
 
.
 
Add
 !
(
! "
comment
" )
)
) *
;
* +
await
 
_context
 
.
 
SaveChangesAsync
 +
(
+ ,
)
, -
;
- .
return
 
comment
 
;
 
}
 	
public
 
async
 
Task
  
UpdateCommentAsync
 ,
(
, -
int
- 0
id
1 3
,
3 4

CommentDto
5 ?

commentDto
@ J
)
J K
{
 	
var
 
existingComment
 
=
  !
await
" '
_context
( 0
.
0 1
Comments
1 9
.
9 :
	FindAsync
: C
(
C D
id
D F
)
F G
;
G H
if
 
(
 
existingComment
 
==
  "
null
# '
)
' (
{
 
throw
 
new
 "
KeyNotFoundException
 .
(
. /
$str
/ C
)
C D
;
D E
}
 
if
 
(
 
!
 
string
 
.
 
IsNullOrEmpty
 %
(
% &

commentDto
& 0
.
0 1
CommentText
1 <
)
< =
)
= >
{
 
existingComment
 
.
  
CommentText
  +
=
, -

commentDto
. 8
.
8 9
CommentText
9 D
;
D E
}
 
if
 
(
 

commentDto
 
.
 
Rate
 
>
  !
$num
" #
)
# $
{
 
existingComment
 
.
  
Rate
  $
=
% &

commentDto
' 1
.
1 2
Rate
2 6
;
6 7
}
 
existingComment
 
.
 
	UpdatedAt
 %
=
& '
DateTime
( 0
.
0 1
UtcNow
1 7
;
7 8
await
¢¢ 
_context
¢¢ 
.
¢¢ 
SaveChangesAsync
¢¢ +
(
¢¢+ ,
)
¢¢, -
;
¢¢- .
}
££ 	
public
¦¦ 
async
¦¦ 
Task
¦¦  
DeleteCommentAsync
¦¦ ,
(
¦¦, -
int
¦¦- 0
id
¦¦1 3
)
¦¦3 4
{
§§ 	
var
¨¨ 
comment
¨¨ 
=
¨¨ 
await
¨¨ 
_context
¨¨  (
.
¨¨( )
Comments
¨¨) 1
.
¨¨1 2
	FindAsync
¨¨2 ;
(
¨¨; <
id
¨¨< >
)
¨¨> ?
;
¨¨? @
if
©© 
(
©© 
comment
©© 
!=
©© 
null
©© 
)
©©  
{
ªª 
_context
«« 
.
«« 
Comments
«« !
.
««! "
Remove
««" (
(
««( )
comment
««) 0
)
««0 1
;
««1 2
await
¬¬ 
_context
¬¬ 
.
¬¬ 
SaveChangesAsync
¬¬ /
(
¬¬/ 0
)
¬¬0 1
;
¬¬1 2
}
­­ 
}
®® 	
}
¯¯ 
}°° %
RD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\DataAcess\CategoryDAO.cs
	namespace 	

DataAccess
 
{ 
public 

class 
CategoryDAO 
{ 
private 
static 
CategoryDAO "
instance# +
;+ ,
public 
static 
CategoryDAO !
Instance" *
{ 	
get 
{		 
if

 
(

 
instance

 
==

 
null

  $
)

$ %
{ 
instance 
= 
new "
CategoryDAO# .
(. /
)/ 0
;0 1
} 
return 
instance 
;  
} 
} 	
public 
async 
Task 
< 
IEnumerable %
<% &
Category& .
>. /
>/ 0
GetCategoryAll1 ?
(? @
)@ A
{ 	
var 
_context 
= 
new 
ShopDbContext ,
(, -
)- .
;. /
var 
list 
= 
await 
_context %
.% &

Categories& 0
.0 1
ToListAsync1 <
(< =
)= >
;> ?
return 
list 
; 
} 	
public 
async 
Task 
< 
Category "
>" #
GetCategoryById$ 3
(3 4
int4 7
?7 8
id9 ;
); <
{ 	
var 
_context 
= 
new 
ShopDbContext ,
(, -
)- .
;. /
var 
category 
= 
await  
_context! )
.) *

Categories* 4
.4 5 
SingleOrDefaultAsync5 I
(I J
cJ K
=>L N
cO P
.P Q

CategoryIdQ [
==\ ^
id_ a
)a b
;b c
return 
category 
; 
} 	
public   
async   
Task   
Add   
(   
Category   &
category  ' /
)  / 0
{!! 	
var"" 
_db"" 
="" 
new"" 
ShopDbContext"" '
(""' (
)""( )
;"") *
_db## 
.## 

Categories## 
.## 
Add## 
(## 
category## '
)##' (
;##( )
await$$ 
_db$$ 
.$$ 
SaveChangesAsync$$ &
($$& '
)$$' (
;$$( )
}%% 	
public'' 
async'' 
Task'' 
Update''  
(''  !
Category''! )
category''* 2
)''2 3
{(( 	
var)) 
_db)) 
=)) 
new)) 
ShopDbContext)) '
())' (
)))( )
;))) *
var** 
existingCategory**  
=**! "
await**# (
GetCategoryById**) 8
(**8 9
category**9 A
.**A B

CategoryId**B L
)**L M
;**M N
if++ 
(++ 
existingCategory++  
!=++! #
null++$ (
)++( )
{,, 
_db-- 
.-- 

Categories-- 
.-- 
Update-- %
(--% &
category--& .
)--. /
;--/ 0
await.. 
_db.. 
... 
SaveChangesAsync.. *
(..* +
)..+ ,
;.., -
}// 
}00 	
public22 
async22 
Task22 
Delete22  
(22  !
int22! $
id22% '
)22' (
{33 	
var44 
_db44 
=44 
new44 
ShopDbContext44 '
(44' (
)44( )
;44) *
var55 
existingCategory55  
=55! "
await55# (
GetCategoryById55) 8
(558 9
id559 ;
)55; <
;55< =
if66 
(66 
existingCategory66  
!=66! #
null66$ (
)66( )
{77 
_db88 
.88 

Categories88 
.88 
Remove88 %
(88% &
existingCategory88& 6
)886 7
;887 8
await99 
_db99 
.99 
SaveChangesAsync99 *
(99* +
)99+ ,
;99, -
}:: 
};; 	
}<< 
}== ÍF
QD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\DataAcess\AccountDAO.cs
	namespace 	
	DataAcess
 
{ 
public 

class 

AccountDAO 
{ 
private 
static 

AccountDAO !
instance" *
;* +
public 
static 

AccountDAO  
Instance! )
{ 	
get		 
{

 
if 
( 
instance 
== 
null  $
)$ %
{ 
instance 
= 
new "

AccountDAO# -
(- .
). /
;/ 0
} 
return 
instance 
;  
} 
} 	
public 
async 
Task 
< 
IEnumerable %
<% &
Account& -
>- .
>. /
GetAccounts0 ;
(; <
)< =
{ 	
var 
_context 
= 
new 
ShopDbContext ,
(, -
)- .
;. /
var 
list 
= 
await 
_context %
.% &
Accounts& .
.. /
ToListAsync/ :
(: ;
); <
;< =
return 
list 
; 
} 	
public 
async 
Task 
< 
int 
> !
GetTotalAccountsAsync 4
(4 5
)5 6
{ 	
using 
( 
var 
_context 
=  !
new" %
ShopDbContext& 3
(3 4
)4 5
)5 6
{ 
var 
totalAccounts !
=" #
await$ )
_context* 2
.2 3
Accounts3 ;
.; <

CountAsync< F
(F G
)G H
;H I
return   
totalAccounts   $
;  $ %
}!! 
}"" 	
public$$ 
async$$ 
Task$$ 
<$$ 
Account$$ !
>$$! "
GetAccountById$$# 1
($$1 2
int$$2 5
?$$5 6
id$$7 9
)$$9 :
{%% 	
var&& 
_context&& 
=&& 
new&& 
ShopDbContext&& ,
(&&, -
)&&- .
;&&. /
var'' 
Account'' 
='' 
await'' 
_context''  (
.''( )
Accounts'') 1
.''1 2 
SingleOrDefaultAsync''2 F
(''F G
s''G H
=>''I K
s''L M
.''M N
	AccountID''N W
==''X Z
id''[ ]
)''] ^
;''^ _
return(( 
Account(( 
;(( 
})) 	
public++ 
async++ 
Task++ 
<++ 
Account++ !
>++! "
GetAccountByEmail++# 4
(++4 5
string++5 ;
email++< A
)++A B
{,, 	
var-- 
_context-- 
=-- 
new-- 
ShopDbContext-- ,
(--, -
)--- .
;--. /
var.. 
Account.. 
=.. 
await.. 
_context..  (
...( )
Accounts..) 1
...1 2 
SingleOrDefaultAsync..2 F
(..F G
s..G H
=>..I K
s..L M
...M N
Email..N S
==..T V
email..W \
)..\ ]
;..] ^
if00 
(00 
Account00 
!=00 
null00 
)00  
{11 
return22 
Account22 
;22 
}33 
else44 
{55 
Console66 
.66 
	WriteLine66 !
(66! "
$"66" $
$str66$ 6
{666 7
email667 <
}66< =
$str66= L
"66L M
)66M N
;66N O
return77 
null77 
;77 
}88 
}99 	
public<< 
async<< 
Task<< 
Add<< 
(<< 
Account<< %
pro<<& )
)<<) *
{== 	
var>> 
_db>> 
=>> 
new>> 
ShopDbContext>> '
(>>' (
)>>( )
;>>) *
_db?? 
.?? 
Accounts?? 
.?? 
Add?? 
(?? 
pro??  
)??  !
;??! "
await@@ 
_db@@ 
.@@ 
SaveChangesAsync@@ &
(@@& '
)@@' (
;@@( )
}AA 	
publicCC 
asyncCC 
TaskCC 
UpdateCC  
(CC  !
AccountCC! (
proCC) ,
)CC, -
{DD 	
varEE 
_dbEE 
=EE 
newEE 
ShopDbContextEE '
(EE' (
)EE( )
;EE) *
varFF 
oFF 
=FF 
awaitFF 
GetAccountByIdFF (
(FF( )
proFF) ,
.FF, -
	AccountIDFF- 6
)FF6 7
;FF7 8
ifGG 
(GG 
oGG 
!=GG 
nullGG 
)GG 
{HH 
_dbII 
.II 
AccountsII 
.II 
UpdateII #
(II# $
proII$ '
)II' (
;II( )
awaitJJ 
_dbJJ 
.JJ 
SaveChangesAsyncJJ *
(JJ* +
)JJ+ ,
;JJ, -
}KK 
}MM 	
publicOO 
asyncOO 
TaskOO 
DeleteOO  
(OO  !
AccountOO! (
proOO) ,
)OO, -
{PP 	
varQQ 
_dbQQ 
=QQ 
newQQ 
ShopDbContextQQ '
(QQ' (
)QQ( )
;QQ) *
varRR 
oRR 
=RR 
awaitRR 
GetAccountByIdRR (
(RR( )
proRR) ,
.RR, -
	AccountIDRR- 6
)RR6 7
;RR7 8
ifSS 
(SS 
oSS 
!=SS 
nullSS 
)SS 
{TT 
_dbUU 
.UU 
AccountsUU 
.UU 
RemoveUU #
(UU# $
proUU$ '
)UU' (
;UU( )
awaitVV 
_dbVV 
.VV 
SaveChangesAsyncVV *
(VV* +
)VV+ ,
;VV, -
}WW 
}YY 	
public[[ 
async[[ 
Task[[ 
ResetPassword[[ '
([[' (
string[[( .
email[[/ 4
,[[4 5
string[[6 <
newPassword[[= H
)[[H I
{\\ 	
var]] 
_context]] 
=]] 
new]] 
ShopDbContext]] ,
(]], -
)]]- .
;]]. /
var^^ 
account^^ 
=^^ 
await^^ 
GetAccountByEmail^^  1
(^^1 2
email^^2 7
)^^7 8
;^^8 9
if__ 
(__ 
account__ 
!=__ 
null__ 
)__  
{`` 
accountaa 
.aa 
Passwordaa  
=aa! "
HashPasswordaa# /
(aa/ 0
newPasswordaa0 ;
)aa; <
;aa< =
_contextbb 
.bb 
Accountsbb !
.bb! "
Updatebb" (
(bb( )
accountbb) 0
)bb0 1
;bb1 2
awaitcc 
_contextcc 
.cc 
SaveChangesAsynccc /
(cc/ 0
)cc0 1
;cc1 2
}dd 
elseee 
{ff 
throwgg 
newgg 
ArgumentExceptiongg +
(gg+ ,
$strgg, Z
)ggZ [
;gg[ \
}hh 
}ii 	
privatekk 
stringkk 
HashPasswordkk #
(kk# $
stringkk$ *
passwordkk+ 3
)kk3 4
{ll 	
usingmm 
(mm 
varmm 
md5mm 
=mm 
Systemmm #
.mm# $
Securitymm$ ,
.mm, -
Cryptographymm- 9
.mm9 :
MD5mm: =
.mm= >
Createmm> D
(mmD E
)mmE F
)mmF G
{nn 
varoo 
hashedBytesoo 
=oo  !
md5oo" %
.oo% &
ComputeHashoo& 1
(oo1 2
Encodingoo2 :
.oo: ;
UTF8oo; ?
.oo? @
GetBytesoo@ H
(ooH I
passwordooI Q
)ooQ R
)ooR S
;ooS T
returnpp 
BitConverterpp #
.pp# $
ToStringpp$ ,
(pp, -
hashedBytespp- 8
)pp8 9
.pp9 :
Replacepp: A
(ppA B
$strppB E
,ppE F
$strppG I
)ppI J
.ppJ K
ToUpperppK R
(ppR S
)ppS T
;ppT U
}qq 
}rr 	
}ww 
}zz 