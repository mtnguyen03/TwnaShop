Ò
XD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\Repository\VietnameseHelper.cs
	namespace 	

Repository
 
{ 
public 

static 
class 
VietnameseHelper (
{ 
public 
static 
string 
RemoveDiacritics -
(- .
string. 4
text5 9
)9 :
{ 	
var 
normalizedString  
=! "
text# '
.' (
	Normalize( 1
(1 2
NormalizationForm2 C
.C D
FormDD I
)I J
;J K
var 
stringBuilder 
= 
new  #
StringBuilder$ 1
(1 2
)2 3
;3 4
foreach		 
(		 
var		 
c		 
in		 
normalizedString		 .
)		. /
{

 
var 
unicodeCategory #
=$ %
CharUnicodeInfo& 5
.5 6
GetUnicodeCategory6 H
(H I
cI J
)J K
;K L
if 
( 
unicodeCategory #
!=$ &
UnicodeCategory' 6
.6 7
NonSpacingMark7 E
)E F
{ 
stringBuilder !
.! "
Append" (
(( )
c) *
)* +
;+ ,
} 
} 
return 
stringBuilder  
.  !
ToString! )
() *
)* +
.+ ,
	Normalize, 5
(5 6
NormalizationForm6 G
.G H
FormCH M
)M N
;N O
} 	
} 
} î"
iD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\Repository\TranslateService\TranslateService.cs
	namespace 	

Repository
 
. 
TranslateService %
{ 
public 

class 
TranslateService !
{ 
private 
readonly 
List 
< 
CultureInfo )
>) *
_defaultCultures+ ;
=< =
new> A
ListB F
<F G
CultureInfoG R
>R S
{ 	
new 
CultureInfo 
( 
$str #
)# $
,$ %
new 
CultureInfo 
( 
$str #
)# $
,$ %
}		 	
;			 

public 
async 
Task 
< 
List 
< 
SelectListItem -
>- .
>. / 
GetAvailableCultures0 D
(D E
)E F
{ 	
await 
Task 
. 
Yield 
( 
) 
; 
CultureInfo 
[ 
] 
cultures "
=# $
CultureInfo% 0
.0 1
GetCultures1 <
(< =
CultureTypes= I
.I J
AllCulturesJ U
)U V
;V W
var 
cultureItems 
= 
cultures '
.' (
Where( -
(- .
c. /
=>0 2
_defaultCultures3 C
.C D
ContainsD L
(L M
cM N
)N O
)O P
. 
Select 
( 
c 
=> 
new  
SelectListItem! /
{0 1
Value2 7
=8 9
c: ;
.; <
Name< @
,@ A
TextB F
=G H
cI J
.J K
DisplayNameK V
}W X
)X Y
. 
ToList 
( 
) 
; 
return 
cultureItems 
;  
} 	
public 
async 
Task 
SetLanguage %
(% &
string& ,
culture- 4
,4 5
HttpResponse6 B
responseC K
)K L
{ 	
await 
Task 
. 
Run 
( 
( 
) 
=>  
{ 
response 
. 
Cookies  
.  !
Append! '
(' ((
CookieRequestCultureProvider 0
.0 1
DefaultCookieName1 B
,B C(
CookieRequestCultureProvider 0
.0 1
MakeCookieValue1 @
(@ A
newA D
RequestCultureE S
(S T
cultureT [
)[ \
)\ ]
,] ^
new 
CookieOptions %
{& '
Expires( /
=0 1
DateTimeOffset2 @
.@ A
UtcNowA G
.G H
AddYearsH P
(P Q
$numQ R
)R S
}T U
) 
; 
} 
) 
; 
}   	
public"" 
int"" 
GetCurrentCulture"" $
(""$ %
HttpContext""% 0
context""1 8
)""8 9
{## 	
var$$ 
requestCulture$$ 
=$$  
context$$! (
.$$( )
Features$$) 1
.$$1 2
Get$$2 5
<$$5 6"
IRequestCultureFeature$$6 L
>$$L M
($$M N
)$$N O
?$$O P
.%% 
RequestCulture%% 
?%%  
.%%  !
Culture%%! (
??%%) +
CultureInfo&& 
.&& 
CurrentCulture&& *
;&&* +
return(( 
requestCulture(( !
.((! "
Name((" &
switch((' -
{)) 
$str** 
=>** 
$num** 
,** 
$str++ 
=>++ 
$num++ 
,++ 
_,, 
=>,, 
$num,, 
}-- 
;-- 
}.. 	
}// 
}00 ‚4
iD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\Repository\StatictisService\StatisticService.cs
	namespace 	

Repository
 
. 
StatictisService %
{ 
public 

class 
StatisticService !
{ 
public 
async 
Task 
< 
StatisticDto &
>& '
GetSalesStatistics( :
(: ;
List; ?
<? @
Order@ E
>E F
ordersG M
)M N
{ 	
var 
totalRevenue 
= 
orders %
. 
Where 
( 
o 
=> 
o 
. 
OrderDetails *
!=+ -
null. 2
)2 3
.		 
Sum		 
(		 
o		 
=>		 
o		 
.		 
OrderDetails		 (
?

 
.

 
Sum

 !
(

! "
od

" $
=>

% '
od

( *
.

* +
	UnitPrice

+ 4
*

5 6
od

7 9
.

9 :
Quantity

: B
)

B C
??

D F
$num

G H
)

H I
;

I J
var 
totalOrders 
= 
orders $
.$ %
Count% *
;* +
var 
successfulOrders  
=! "
orders# )
.) *
Count* /
(/ 0
o0 1
=>2 4
o5 6
.6 7
Status7 =
==> @
$numA B
)B C
;C D
var 
pendingOrders 
= 
orders  &
.& '
Count' ,
(, -
o- .
=>/ 1
o2 3
.3 4
Status4 :
==; =
$num> ?
)? @
;@ A
var 
cancelledOrders 
=  !
orders" (
.( )
Count) .
(. /
o/ 0
=>1 3
o4 5
.5 6
Status6 <
=== ?
$num@ A
)A B
;B C
var 
returnedOrders 
=  
orders! '
.' (
Count( -
(- .
o. /
=>0 2
o3 4
.4 5
Status5 ;
==< >
$num? @
)@ A
;A B
var 
disputedOrders 
=  
orders! '
.' (
Count( -
(- .
o. /
=>0 2
o3 4
.4 5
Status5 ;
==< >
$num? @
)@ A
;A B
var 
dongdangyeuCauTra !
=" #
orders$ *
.* +
Count+ 0
(0 1
o1 2
=>3 5
o6 7
.7 8
Status8 >
==? A
$numB C
)C D
;D E
var "
donDangyeyCauGiaiQuyet &
=' (
orders) /
./ 0
Count0 5
(5 6
o6 7
=>8 :
o; <
.< =
Status= C
==D F
$numG H
)H I
;I J
return 
new 
StatisticDto #
{ 
TotalRevenue 
= 
totalRevenue +
,+ ,
TotalOrders 
= 
totalOrders )
,) *
SuccessfulOrders  
=! "
successfulOrders# 3
,3 4
PendingOrders 
= 
pendingOrders  -
,- .
CancelledOrders 
=  !
cancelledOrders" 1
,1 2
ReturnedOrders 
=  
returnedOrders! /
,/ 0
DisputedOrders   
=    
disputedOrders  ! /
,  / 0
DangYeuCauGiaiQuyet!! #
=!!$ %"
donDangyeyCauGiaiQuyet!!& <
,!!< =
DangYeuCautra"" 
="" 
dongdangyeuCauTra""  1
}$$ 
;$$ 
}%% 	
public'' 
async'' 
Task'' 
<'' 
List'' 
<'' 
MonthlyRevenueDto'' 0
>''0 1
>''1 2
GetMonthlyRevenue''3 D
(''D E
List''E I
<''I J
Order''J O
>''O P
orders''Q W
)''W X
{(( 	
var)) 
confirmedOrders)) 
=))  !
orders))" (
.** 
Where** 
(** 
o** 
=>** 
o** 
.** 
Status** $
==**% '
$num**( )
)**) *
.++ 
GroupBy++ 
(++ 
o++ 
=>++ 
new++ !
{++" #
o++$ %
.++% &
	OrderDate++& /
.++/ 0
Year++0 4
,++4 5
o++6 7
.++7 8
	OrderDate++8 A
.++A B
Month++B G
}++H I
)++I J
.,, 
Select,, 
(,, 
g,, 
=>,, 
new,,  
MonthlyRevenueDto,,! 2
{-- 
Month.. 
=.. 
g.. 
... 
Key.. !
...! "
Month.." '
,..' (
Year// 
=// 
g// 
.// 
Key//  
.//  !
Year//! %
,//% &
TotalRevenue00  
=00! "
g00# $
.00$ %
Count00% *
(00* +
)00+ ,
*00- .
$num00/ 5
}11 
)11 
.22 
OrderBy22 
(22 
m22 
=>22 
m22 
.22  
Year22  $
)22$ %
.22% &
ThenBy22& ,
(22, -
m22- .
=>22/ 1
m222 3
.223 4
Month224 9
)229 :
.33 
ToList33 
(33 
)33 
;33 
return55 
confirmedOrders55 "
;55" #
}66 	
}77 
public99 

class99 
MonthlyRevenueDto99 "
{:: 
public;; 
int;; 
Year;; 
{;; 
get;; 
;;; 
set;; "
;;;" #
};;$ %
public<< 
int<< 
Month<< 
{<< 
get<< 
;<< 
set<<  #
;<<# $
}<<% &
public== 
decimal== 
TotalRevenue== #
{==$ %
get==& )
;==) *
set==+ .
;==. /
}==0 1
}>> 
}AA Ì
kD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\Repository\SearchAutoNest\ElasticsearchService.cs
	namespace 	

Repository
 
. 
SearchAutoNest #
{ 
public 

class  
ElasticsearchService %
{ 
private

 
readonly

 
IElasticClient

 '
_client

( /
;

/ 0
public  
ElasticsearchService #
(# $
IElasticClient$ 2
client3 9
)9 :
{ 	
_client 
= 
client 
; 
} 	
public 
async 
Task #
CreateProductIndexAsync 1
(1 2
)2 3
{ 	
var 
createIndexResponse #
=$ %
await& +
_client, 3
.3 4
Indices4 ;
.; <
CreateAsync< G
(G H
$strH R
,R S
cT U
=>V X
cY Z
. 
Map 
< 
Product 
> 
( 
m 
=>  "
m# $
. 
AutoMap 
( 
) 
. 

Properties 
(  
ps  "
=># %
ps& (
. 
Text 
( 
t 
=>  "
t# $
. 
Name !
(! "
n" #
=>$ &
n' (
.( )
ProductName) 4
)4 5
. 
Analyzer %
(% &
$str& *
)* +
) 
) 
) 
) 
; 
} 	
public"" 
async"" 
Task"" 
IndexProductAsync"" +
(""+ ,
Product"", 3
product""4 ;
)""; <
{## 	
await$$ 
_client$$ 
.$$ 
IndexDocumentAsync$$ ,
($$, -
product$$- 4
)$$4 5
;$$5 6
}%% 	
public'' 
async'' 
Task'' 
<'' 
List'' 
<'' 
string'' %
>''% &
>''& '
SearchProductsAsync''( ;
(''; <
string''< B

searchTerm''C M
)''M N
{(( 	
var)) 
searchResponse)) 
=))  
await))! &
_client))' .
.)). /
SearchAsync))/ :
<)): ;
Product)); B
>))B C
())C D
s))D E
=>))F H
s))I J
.** 
Query** 
(** 
q** 
=>** 
q** 
.++ 
Match++ 
(++ 
m++ 
=>++ 
m++  !
.,, 
Field,, 
(,, 
f,,  
=>,,! #
f,,$ %
.,,% &
ProductName,,& 1
),,1 2
.-- 
Query-- 
(-- 

searchTerm-- )
)--) *
).. 
)// 
)00 
;00 
var22 
productNames22 
=22 
new22 "
List22# '
<22' (
string22( .
>22. /
(22/ 0
)220 1
;221 2
foreach33 
(33 
var33 
hit33 
in33 
searchResponse33  .
.33. /
Hits33/ 3
)333 4
{44 
productNames55 
.55 
Add55  
(55  !
hit55! $
.55$ %
Source55% +
.55+ ,
ProductName55, 7
)557 8
;558 9
}66 
return88 
productNames88 
;88  
}99 	
}:: 
};; ˝
YD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\Repository\ProductRepository.cs
	namespace 	

Repository
 
{ 
public 

class 
ProductRepository "
:# $
IProductRepository% 7
{ 
public 
async 
Task 
Add 
( 
Product %
pro& )
)) *
=>+ -
await. 3

ProductDAO4 >
.> ?
Instance? G
.G H
AddH K
(K L
proL O
)O P
;P Q
public 
async 
Task 
Delete  
(  !
Product! (
pro) ,
), -
=>. 0
await1 6

ProductDAO7 A
.A B
InstanceB J
.J K
DeleteK Q
(Q R
proR U
)U V
;V W
public 
async 
Task 
< 
Product !
>! "
GetProductById# 1
(1 2
int2 5
id6 8
)8 9
=>: <
await= B

ProductDAOC M
.M N
InstanceN V
.V W
GetProductByIdW e
(e f
idf h
)h i
;i j
public 
async 
Task 
< 
IEnumerable %
<% &
Product& -
>- .
>. /
GetProducts0 ;
(; <
)< =
=>> @
awaitA F

ProductDAOG Q
.Q R
InstanceR Z
.Z [
GetProducts[ f
(f g
)g h
;h i
public		 
async		 
Task		 
Update		  
(		  !
Product		! (
pro		) ,
)		, -
=>		. 0
await		1 6

ProductDAO		7 A
.		A B
Instance		B J
.		J K
Update		K Q
(		Q R
pro		R U
)		U V
;		V W
public

 

IQueryable

 
<

 
Product

 "
>

" #"
GetProductsAsQueryable

$ :
(

: ;
)

; <
=>

= ?

ProductDAO

@ J
.

J K
Instance

K S
.

S T"
GetProductsAsQueryable

T j
(

j k
)

k l
;

l m
public 
async 
Task 
< 
int 
> #
GetTotalProductQuantity 6
(6 7
)7 8
=>: <
await= B

ProductDAOC M
.M N
InstanceN V
.V W#
GetTotalProductQuantityW n
(n o
)o p
;p q
} 
} Ê
aD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\Repository\PaymentService\PayProcess.cs
	namespace 	

Repository
 
. 
PaymentService #
{ 
public 

class 

PayProcess 
{ 
private 
readonly 
PayOS 
_payOS %
;% &
public 

PayProcess 
( 
PayOS 
payOS  %
)% &
{ 	
_payOS 
= 
payOS 
; 
}		 	
} 
} ¡	
`D:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\Repository\PaymentService\Constants.cs
	namespace 	

Repository
 
. 
PaymentService #
{ 
public 

class 
	Constants 
{ 
public 
string 
ClientId 
{  
get! $
;$ %
}& '
public 
string 
ApiKey 
{ 
get "
;" #
}$ %
public 
string 
ChecksumKey !
{" #
get$ '
;' (
}) *
public		 
	Constants		 
(		 
IConfiguration		 '
configuration		( 5
)		5 6
{

 	
ClientId 
= 
configuration $
[$ %
$str% 9
]9 :
;: ;
ApiKey 
= 
configuration "
[" #
$str# 5
]5 6
;6 7
ChecksumKey 
= 
configuration '
[' (
$str( ?
]? @
;@ A
} 	
} 
} ç
RD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\Repository\OtpService.cs
	namespace 	

Repository
 
{ 
public 

class 

OtpService 
: 
IOtpService )
{ 
private 
readonly  
ConcurrentDictionary -
<- .
string. 4
,4 5
string6 <
>< =
	_otpStore> G
=H I
newJ M 
ConcurrentDictionaryN b
<b c
stringc i
,i j
stringk q
>q r
(r s
)s t
;t u
public 
void 
GenerateOtp 
(  
string  &
email' ,
,, -
out. 1
string2 8
otp9 <
)< =
{ 	
otp		 
=		 
new		 
Random		 
(		 
)		 
.		 
Next		 #
(		# $
$num		$ *
,		* +
$num		, 2
)		2 3
.		3 4
ToString		4 <
(		< =
)		= >
;		> ?
	_otpStore

 
[

 
email

 
]

 
=

 
otp

 "
;

" #
} 	
public 
bool 
ValidateOtp 
(  
string  &
email' ,
,, -
string. 4
otp5 8
)8 9
{ 	
if 
( 
	_otpStore 
. 
TryGetValue %
(% &
email& +
,+ ,
out- 0
var1 4
	storedOtp5 >
)> ?
)? @
{ 
return 
	storedOtp  
==! #
otp$ '
;' (
} 
return 
false 
; 
} 	
} 
} ¿
WD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\Repository\OrderRepository.cs
	namespace 	

Repository
 
{ 
public 

class 
OrderRepository  
:! "
IOrderRepository# 3
{ 
public 
async 
Task 
< 
IEnumerable %
<% &
Order& +
>+ ,
>, -
	GetOrders. 7
(7 8
)8 9
{ 	
return 
await 
OrderDAO !
.! "
Instance" *
.* +
	GetOrders+ 4
(4 5
)5 6
;6 7
} 	
public

 
async

 
Task

 
<

 
IEnumerable

 %
<

% &
OrderReportDto

& 4
>

4 5
>

5 6
GetOrdersDto

7 C
(

C D
)

D E
=>

F H
await

I N
OrderDAO

O W
.

W X
Instance

X `
.

` a
GetOrdersDto

a m
(

m n
)

n o
;

o p
public 
async 
Task 
< 
Order 
>  
GetOrderById! -
(- .
int. 1
?1 2
id3 5
)5 6
{ 	
return 
await 
OrderDAO !
.! "
Instance" *
.* +
GetOrderById+ 7
(7 8
id8 :
): ;
;; <
} 	
public 
async 
Task 
Add 
( 
Order #
order$ )
)) *
{ 	
await 
OrderDAO 
. 
Instance #
.# $
Add$ '
(' (
order( -
)- .
;. /
} 	
public 
async 
Task 
Update  
(  !
Order! &
order' ,
), -
{ 	
await 
OrderDAO 
. 
Instance #
.# $
Update$ *
(* +
order+ 0
)0 1
;1 2
} 	
public 
async 
Task 
Delete  
(  !
Order! &
order' ,
), -
{ 	
await 
OrderDAO 
. 
Instance #
.# $
Delete$ *
(* +
order+ 0
)0 1
;1 2
} 	
} 
}   é
]D:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\Repository\OrderDetailRepository.cs
	namespace 	

Repository
 
{ 
public 

class !
OrderDetailRepository &
:' ("
IOrderDetailRepository) ?
{ 
public 
async 
Task 
< 
IEnumerable %
<% &
OrderDetail& 1
>1 2
>2 3
GetOrderDetails4 C
(C D
)D E
{ 	
return 
await 
OrderDetailDAO '
.' (
Instance( 0
.0 1
GetOrderDetails1 @
(@ A
)A B
;B C
} 	
public

 
async

 
Task

 
<

 
OrderDetail

 %
>

% &
GetOrderDetailByIds

' :
(

: ;
int

; >
orderId

? F
,

F G
int

H K
	productId

L U
)

U V
{ 	
return 
await 
OrderDetailDAO '
.' (
Instance( 0
.0 1
GetOrderDetailByIds1 D
(D E
orderIdE L
,L M
	productIdN W
)W X
;X Y
} 	
public 
async 
Task 
Add 
( 
OrderDetail )
orderDetail* 5
)5 6
{ 	
await 
OrderDetailDAO  
.  !
Instance! )
.) *
Add* -
(- .
orderDetail. 9
)9 :
;: ;
} 	
public 
async 
Task 
Update  
(  !
OrderDetail! ,
orderDetail- 8
)8 9
{ 	
await 
OrderDetailDAO  
.  !
Instance! )
.) *
Update* 0
(0 1
orderDetail1 <
)< =
;= >
} 	
public 
async 
Task 
Delete  
(  !
OrderDetail! ,
orderDetail- 8
)8 9
{ 	
await 
OrderDetailDAO  
.  !
Instance! )
.) *
Delete* 0
(0 1
orderDetail1 <
)< =
;= >
} 	
} 
} ü
^D:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\Repository\NotificationRepository.cs
	namespace 	

Repository
 
{ 
public 

class "
NotificationRepository '
:( )#
INotificationRepository* A
{ 
public 
async 
Task 
< 
IEnumerable %
<% &
Notification& 2
>2 3
>3 4(
GetNotificationByUserIdAsync5 Q
(Q R
intR U
userIdV \
)\ ]
{ 	
return 
await 
NotificationDAO (
.( )
Instance) 1
.1 2)
GetNotificationsByUserIdAsync2 O
(O P
userIdP V
)V W
;W X
}		 	
public 
async 
Task 
< 
int 
> %
GetTotalNotiQuantityAsync 8
(8 9
int9 <
?< =
userId> D
)D E
{ 	
return 
await 
NotificationDAO (
.( )
Instance) 1
.1 2%
GetTotalNotiQuantityAsync2 K
(K L
userIdL R
)R S
;S T
} 	
public 
async 
Task 
Add 
( 
Notification *
notification+ 7
)7 8
{ 	
await 
NotificationDAO !
.! "
Instance" *
.* +
Add+ .
(. /
notification/ ;
); <
;< =
} 	
public 
async 
Task 
< 
bool 
> 
	DeleteAll  )
() *
int* -
?- .
userId/ 5
)5 6
{ 	
if 
( 
userId 
<= 
$num 
) 
{ 
return 
false 
; 
} 
return 
await 
NotificationDAO (
.( )
Instance) 1
.1 2
	DeleteAll2 ;
(; <
userId< B
)B C
;C D
}   	
public## 
async## 
Task## 
Delete##  
(##  !
int##! $
notificationId##% 3
)##3 4
{$$ 	
await&& 
NotificationDAO&& "
.&&" #
Instance&&# +
.&&+ ,
Delete&&, 2
(&&2 3
notificationId&&3 A
)&&A B
;&&B C
}'' 	
}(( 
})) Ì+
dD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\Repository\MailService\SendGmailService.cs
	namespace 	

Repository
 
. 
MailService  
{ 
public 

class 
SendGmailService !
:" #
ISendGmailService$ 5
{ 
private 
readonly 
MailSettings %
_mailSettings& 3
;3 4
public 
SendGmailService 
(  
IOptions  (
<( )
MailSettings) 5
>5 6
mailSettings7 C
)C D
{		 	
_mailSettings

 
=

 
mailSettings

 (
.

( )
Value

) .
;

. /
} 	
public 
async 
Task 
< 
string  
>  !
SendMail" *
(* +
MailContent+ 6
mailContent7 B
)B C
{ 	
var 
email 
= 
new 
MimeMessage '
(' (
)( )
;) *
email 
. 
Sender 
= 
new 
MailboxAddress -
(- .
_mailSettings. ;
.; <
DisplayName< G
,G H
_mailSettingsI V
.V W
MailW [
)[ \
;\ ]
email 
. 
From 
. 
Add 
( 
new 
MailboxAddress -
(- .
_mailSettings. ;
.; <
DisplayName< G
,G H
_mailSettingsI V
.V W
MailW [
)[ \
)\ ]
;] ^
email 
. 
To 
. 
Add 
( 
new 
MailboxAddress +
(+ ,
mailContent, 7
.7 8
To8 :
,: ;
mailContent< G
.G H
ToH J
)J K
)K L
;L M
email 
. 
Subject 
= 
mailContent '
.' (
Subject( /
;/ 0
var 
builder 
= 
new 
BodyBuilder )
() *
)* +
;+ ,
builder 
. 
HtmlBody 
= 
mailContent *
.* +
Body+ /
;/ 0
email 
. 
Body 
= 
builder  
.  !
ToMessageBody! .
(. /
)/ 0
;0 1
using 
var 
smtp 
= 
new  
MailKit! (
.( )
Net) ,
., -
Smtp- 1
.1 2

SmtpClient2 <
(< =
)= >
;> ?
try 
{ 
await 
smtp 
. 
ConnectAsync '
(' (
_mailSettings( 5
.5 6
Host6 :
,: ;
_mailSettings< I
.I J
PortJ N
,N O
SecureSocketOptionsP c
.c d
StartTlsd l
)l m
;m n
await 
smtp 
. 
AuthenticateAsync ,
(, -
_mailSettings- :
.: ;
Mail; ?
,? @
_mailSettingsA N
.N O
PasswordO W
)W X
;X Y
await 
smtp 
. 
	SendAsync $
($ %
email% *
)* +
;+ ,
} 
catch   
(   
	Exception   
ex   
)    
{!! 
Console"" 
."" 
	WriteLine"" !
(""! "
ex""" $
.""$ %
Message""% ,
)"", -
;""- .
return## 
$str## 
+##  
ex##! #
.### $
Message##$ +
;##+ ,
}$$ 
smtp%% 
.%% 

Disconnect%% 
(%% 
true%%  
)%%  !
;%%! "
return&& 
$str&& -
;&&- .
}'' 	
public(( 
async(( 
Task(( 
SendEmailAsync(( (
(((( )
string(() /
email((0 5
,((5 6
string((7 =
subject((> E
,((E F
string((G M
htmlMessage((N Y
)((Y Z
{)) 	
await** 
SendMail** 
(** 
new** 
MailContent** *
(*** +
)**+ ,
{++ 
To,, 
=,, 
email,, 
,,, 
Subject-- 
=-- 
subject-- !
,--! "
Body.. 
=.. 
htmlMessage.. "
}// 
)// 
;// 
}00 	
}11 
public33 

class33 
MailContent33 
{44 
public55 
string55 
To55 
{55 
get55 
;55 
set55  #
;55# $
}55% &
public66 
string66 
Subject66 
{66 
get66  #
;66# $
set66% (
;66( )
}66* +
public77 
string77 
Body77 
{77 
get77  
;77  !
set77" %
;77% &
}77' (
}88 
}99 ∞
`D:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\Repository\MailService\MailSettings.cs
	namespace 	

Repository
 
. 
MailService  
{ 
public 

class 
MailSettings 
{ 
public 
string 
Mail 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
DisplayName !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Host 
{ 
get  
;  !
set" %
;% &
}' (
public		 
int		 
Port		 
{		 
get		 
;		 
set		 "
;		" #
}		$ %
}

 
} Ì
eD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\Repository\MailService\ISendGmailService.cs
	namespace 	

Repository
 
. 
MailService  
{ 
public 

	interface 
ISendGmailService &
{ 
Task 
< 
string 
> 
SendMail 
( 
MailContent )
mailContent* 5
)5 6
;6 7
Task 
SendEmailAsync 
( 
string "
email# (
,( )
string* 0
subject1 8
,8 9
string: @
htmlMessageA L
)L M
;M N
} 
}		 î

ZD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\Repository\IProductRepository.cs
	namespace 	

Repository
 
{ 
public 

	interface 
IProductRepository '
{ 
Task 
< 
IEnumerable 
< 
Product  
>  !
>! "
GetProducts# .
(. /
)/ 0
;0 1
Task 
< 
Product 
> 
GetProductById $
($ %
int% (
id) +
)+ ,
;, -
Task 
Add 
( 
Product 
pro 
) 
; 
Task 
Update 
( 
Product 
pro 
)  
;  !
Task		 
Delete		 
(		 
Product		 
pro		 
)		  
;		  !

IQueryable

 
<

 
Product

 
>

 "
GetProductsAsQueryable

 2
(

2 3
)

3 4
;

4 5
Task 
< 
int 
> #
GetTotalProductQuantity )
() *
)* +
;+ ,
} 
} ı
SD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\Repository\IOtpService.cs
	namespace 	

Repository
 
{ 
public 

	interface 
IOtpService  
{ 
void 
GenerateOtp 
( 
string 
email  %
,% &
out' *
string+ 1
otp2 5
)5 6
;6 7
bool 
ValidateOtp 
( 
string 
email  %
,% &
string' -
otp. 1
)1 2
;2 3
} 
} ≤	
XD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\Repository\IOrderRepository.cs
	namespace 	

Repository
 
{ 
public 

	interface 
IOrderRepository %
{ 
Task 
< 
IEnumerable 
< 
Order 
> 
>  
	GetOrders! *
(* +
)+ ,
;, -
Task 
< 
Order 
> 
GetOrderById  
(  !
int! $
?$ %
id& (
)( )
;) *
Task 
Add 
( 
Order 
order 
) 
; 
Task 
Update 
( 
Order 
order 
)  
;  !
Task		 
Delete		 
(		 
Order		 
order		 
)		  
;		  !
Task

 
<

 
IEnumerable

 
<

 
OrderReportDto

 '
>

' (
>

( )
GetOrdersDto

* 6
(

6 7
)

7 8
;

8 9
} 
} ﬁ
^D:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\Repository\IOrderDetailRepository.cs
	namespace 	

Repository
 
{ 
public 

	interface "
IOrderDetailRepository +
{ 
Task 
< 
IEnumerable 
< 
OrderDetail $
>$ %
>% &
GetOrderDetails' 6
(6 7
)7 8
;8 9
Task 
< 
OrderDetail 
> 
GetOrderDetailByIds -
(- .
int. 1
orderId2 9
,9 :
int; >
	productId? H
)H I
;I J
Task 
Add 
( 
OrderDetail 
orderDetail (
)( )
;) *
Task 
Update 
( 
OrderDetail 
orderDetail  +
)+ ,
;, -
Task		 
Delete		 
(		 
OrderDetail		 
orderDetail		  +
)		+ ,
;		, -
}

 
} è	
_D:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\Repository\INotificationRepository.cs
	namespace 	

Repository
 
{ 
public 

	interface #
INotificationRepository ,
{ 
Task 
< 
IEnumerable 
< 
Notification %
>% &
>& '(
GetNotificationByUserIdAsync( D
(D E
intE H
userIdI O
)O P
;P Q
Task 
< 
int 
> %
GetTotalNotiQuantityAsync +
(+ ,
int, /
?/ 0
userId1 7
)7 8
;8 9
Task 
Add 
( 
Notification 
notification *
)* +
;+ ,
Task"" 
<"" 
bool"" 
>"" 
	DeleteAll"" 
("" 
int""  
?""  !
userId""" (
)""( )
;"") *
Task** 
Delete** 
(** 
int** 
pro** 
)** 
;** 
}++ 
},, Ù
[D:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\Repository\ICategoryRepository.cs
	namespace 	

Repository
 
{ 
public 

	interface 
ICategoryRepository (
{ 
Task 
< 
IEnumerable 
< 
Category !
>! "
>" #
GetCategoryAll$ 2
(2 3
)3 4
;4 5
Task 
< 
Category 
> 
GetCategoryById &
(& '
int' *
id+ -
)- .
;. /
Task 
Add 
( 
Category 
category "
)" #
;# $
Task 
Update 
( 
Category 
category %
)% &
;& '
Task		 
Delete		 
(		 
int		 
id		 
)		 
;		 
}

 
} È
ZD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\Repository\IAccountRepository.cs
	namespace 	

Repository
 
{ 
public 

	interface 
IAccountRepository '
{ 
Task 
< 
IEnumerable 
< 
Account  
>  !
>! "
GetAccounts# .
(. /
)/ 0
;0 1
Task 
< 
Account 
> 
GetAccountById $
($ %
int% (
id) +
)+ ,
;, -
Task 
Add 
( 
Account 
pro 
) 
; 
Task 
Update 
( 
Account 
pro 
)  
;  !
Task		 
Delete		 
(		 
Account		 
pro		 
)		  
;		  !
Task

 
<

 
Account

 
>

 
GetAccountByEmail

 '
(

' (
string

( .
pro

/ 2
)

2 3
;

3 4
Task 
ResetPassword 
( 
string !
email" '
,' (
string) /
newPassword0 ;
); <
;< =
Task 
< 
int 
> !
GetTotalAccountsAsync '
(' (
)( )
;) *
} 
} V
TD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\Repository\global_using.cs˚
fD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\Repository\CommentRepo\ICommentRepository.cs
	namespace 	

Repository
 
. 
CommentRepo  
{ 
public 

	interface 
ICommentRepository '
{ 
Task 
< 
IEnumerable 
< 
Comment  
>  !
>! "
GetAllCommentsAsync# 6
(6 7
)7 8
;8 9
Task 
< 
Comment 
? 
> 
GetCommentByIdAsync *
(* +
int+ .
id/ 1
)1 2
;2 3
Task 
< 
IEnumerable 
< 

CommentDto #
># $
>$ %'
GetCommentsByProductIdAsync& A
(A B
intB E
	productIdF O
)O P
;P Q
Task 
< 
IEnumerable 
< 

CommentDto #
># $
>$ %(
GetCommentsByProductIdAsync2& B
(B C
intC F
	productIdG P
,P Q
intR U
userCommentIdV c
)c d
;d e
Task		 
<		 
Comment		 
>		 
AddCommentAsync		 %
(		% &
Comment		& -
comment		. 5
)		5 6
;		6 7
Task

 
UpdateCommentAsync

 
(

  
int

  #
id

$ &
,

& '

CommentDto

( 2

commentDto

3 =
)

= >
;

> ?
Task 
DeleteCommentAsync 
(  
int  #
id$ &
)& '
;' (
} 
} å
eD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\Repository\CommentRepo\CommentRepository.cs
	namespace 	

Repository
 
. 
CommentRepo  
{ 
public 

class 
CommentRepository "
:# $
ICommentRepository% 7
{ 
public 
async 
Task 
< 
IEnumerable %
<% &
Comment& -
>- .
>. /
GetAllCommentsAsync0 C
(C D
)D E
{ 	
return 
await 

CommentDao #
.# $
Instance$ ,
., -
GetAllCommentsAsync- @
(@ A
)A B
;B C
}		 	
public 
async 
Task 
< 
Comment !
?! "
>" #
GetCommentByIdAsync$ 7
(7 8
int8 ;
id< >
)> ?
{ 	
return 
await 

CommentDao #
.# $
Instance$ ,
., -
GetCommentByIdAsync- @
(@ A
idA C
)C D
;D E
} 	
public 
async 
Task 
< 
IEnumerable %
<% &

CommentDto& 0
>0 1
>1 2'
GetCommentsByProductIdAsync3 N
(N O
intO R
	productIdS \
)\ ]
{ 	
return 
await 

CommentDao #
.# $
Instance$ ,
., -'
GetCommentsByProductIdAsync- H
(H I
	productIdI R
)R S
;S T
} 	
public 
async 
Task 
< 
IEnumerable %
<% &

CommentDto& 0
>0 1
>1 2(
GetCommentsByProductIdAsync23 O
(O P
intP S
	productIdT ]
,] ^
int_ b
userCommentIdc p
)p q
{ 	
return 
await 

CommentDao #
.# $
Instance$ ,
., -(
GetCommentsByProductIdAsync2- I
(I J
	productIdJ S
,S T
userCommentIdV c
)c d
;d e
} 	
public 
async 
Task 
< 
Comment !
>! "
AddCommentAsync# 2
(2 3
Comment3 :
comment; B
)B C
{ 	
return 
await 

CommentDao #
.# $
Instance$ ,
., -
AddCommentAsync- <
(< =
comment= D
)D E
;E F
} 	
public 
async 
Task 
UpdateCommentAsync ,
(, -
int- 0
id1 3
,3 4

CommentDto5 ?

commentDto@ J
)J K
{   	
await!! 

CommentDao!! 
.!! 
Instance!! %
.!!% &
UpdateCommentAsync!!& 8
(!!8 9
id!!9 ;
,!!; <

commentDto!!< F
)!!F G
;!!G H
}"" 	
public$$ 
async$$ 
Task$$ 
DeleteCommentAsync$$ ,
($$, -
int$$- 0
id$$1 3
)$$3 4
{%% 	
await&& 

CommentDao&& 
.&& 
Instance&& %
.&&% &
DeleteCommentAsync&&& 8
(&&8 9
id&&9 ;
)&&; <
;&&< =
}'' 	
}** 
},, ”
ZD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\Repository\CategoryRepository.cs
	namespace 	

Repository
 
{ 
public 

class 
CategoryRepository #
:$ %
ICategoryRepository& 9
{ 
public 
async 
Task 
< 
IEnumerable %
<% &
Category& .
>. /
>/ 0
GetCategoryAll1 ?
(? @
)@ A
{ 	
return 
await 
CategoryDAO $
.$ %
Instance% -
.- .
GetCategoryAll. <
(< =
)= >
;> ?
} 	
public

 
async

 
Task

 
<

 
Category

 "
>

" #
GetCategoryById

$ 3
(

3 4
int

4 7
id

8 :
)

: ;
{ 	
return 
await 
CategoryDAO $
.$ %
Instance% -
.- .
GetCategoryById. =
(= >
id> @
)@ A
;A B
} 	
public 
async 
Task 
Add 
( 
Category &
category' /
)/ 0
{ 	
await 
CategoryDAO 
. 
Instance &
.& '
Add' *
(* +
category+ 3
)3 4
;4 5
} 	
public 
async 
Task 
Update  
(  !
Category! )
category* 2
)2 3
{ 	
await 
CategoryDAO 
. 
Instance &
.& '
Update' -
(- .
category. 6
)6 7
;7 8
} 	
public 
async 
Task 
Delete  
(  !
int! $
id% '
)' (
{ 	
await 
CategoryDAO 
. 
Instance &
.& '
Delete' -
(- .
id. 0
)0 1
;1 2
} 	
} 
} ≠0
_D:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\Repository\CartService\CartService.cs
	namespace 	

Repository
 
. 
CartService  
{ 
public 

class 
CartService 
{ 
private 
readonly  
IHttpContextAccessor - 
_httpContextAccessor. B
;B C
public 
CartService 
(  
IHttpContextAccessor /
httpContextAccessor0 C
)C D
{ 	 
_httpContextAccessor		  
=		! "
httpContextAccessor		# 6
;		6 7
}

 	
public 
async 
Task 
AddToCartAsync (
(( )
Product) 0
product1 8
,8 9
int: =
quantity> F
)F G
{ 	
var 
cart 
= 
await 
GetCartAsync )
() *
)* +
;+ ,
var 
	cartItems 
= 
string "
." #
IsNullOrEmpty# 0
(0 1
cart1 5
)5 6
? 
new 
List 
< 
CartItem #
># $
($ %
)% &
: 
JsonSerializer  
.  !
Deserialize! ,
<, -
List- 1
<1 2
CartItem2 :
>: ;
>; <
(< =
cart= A
)A B
;B C
var 
cartItem 
= 
	cartItems $
.$ %
Find% )
() *
ci* ,
=>- /
ci0 2
.2 3
	ProductId3 <
=== ?
product@ G
.G H
	ProductIdH Q
)Q R
;R S
if 
( 
cartItem 
== 
null  
)  !
{ 
	cartItems 
. 
Add 
( 
new !
CartItem" *
{ 
	ProductId 
= 
product  '
.' (
	ProductId( 1
,1 2
ProductName 
=  !
product" )
.) *
ProductName* 5
,5 6
	UnitPrice 
= 
product  '
.' (
	UnitPrice( 1
,1 2
Quantity 
= 
quantity '
,' (
Image 
= 
product #
.# $
ProductImage$ 0
} 
) 
; 
} 
else 
{ 
cartItem   
.   
Quantity   !
+=  " $
quantity  % -
;  - .
}!! 
await## 
SaveCartAsync## 
(##  
JsonSerializer##  .
.##. /
	Serialize##/ 8
(##8 9
	cartItems##9 B
)##B C
)##C D
;##D E
}$$ 	
private&& 
async&& 
Task&& 
<&& 
string&& !
>&&! "
GetCartAsync&&# /
(&&/ 0
)&&0 1
{'' 	
await(( 
Task(( 
.(( 
Delay(( 
((( 
$num(( 
)((  
;((  !
return))  
_httpContextAccessor)) '
.))' (
HttpContext))( 3
.))3 4
Session))4 ;
.)); <
	GetString))< E
())E F
$str))F L
)))L M
;))M N
}** 	
private,, 
async,, 
Task,, 
SaveCartAsync,, (
(,,( )
string,,) /
cart,,0 4
),,4 5
{-- 	
await.. 
Task.. 
... 
Delay.. 
(.. 
$num.. 
)..  
;..  ! 
_httpContextAccessor//  
.//  !
HttpContext//! ,
.//, -
Session//- 4
.//4 5
	SetString//5 >
(//> ?
$str//? E
,//E F
cart//G K
)//K L
;//L M
}00 	
public55 
async55 
Task55 
<55 
int55 
>55 
GetCartCountAsync55 0
(550 1
)551 2
{66 	
var77 
cart77 
=77 
await77 
GetCartAsync77 )
(77) *
)77* +
;77+ ,
var88 
	cartItems88 
=88 
string88 "
.88" #
IsNullOrEmpty88# 0
(880 1
cart881 5
)885 6
?99 
new99 
List99 
<99 
CartItem99 #
>99# $
(99$ %
)99% &
::: 
JsonSerializer::  
.::  !
Deserialize::! ,
<::, -
List::- 1
<::1 2
CartItem::2 :
>::: ;
>::; <
(::< =
cart::= A
)::A B
;::B C
return== 
	cartItems== 
.== 
Sum==  
(==  !
ci==! #
=>==$ &
ci==' )
.==) *
Quantity==* 2
)==2 3
;==3 4
}>> 	
}?? 
publicAA 

classAA 
CartItemAA 
{BB 
publicCC 
intCC 
	ProductIdCC 
{CC 
getCC "
;CC" #
setCC$ '
;CC' (
}CC) *
publicDD 
stringDD 
ProductNameDD !
{DD" #
getDD$ '
;DD' (
setDD) ,
;DD, -
}DD. /
publicEE 
stringEE 
ImageEE 
{EE 
getEE !
;EE! "
setEE# &
;EE& '
}EE( )
publicFF 
decimalFF 
	UnitPriceFF  
{FF! "
getFF# &
;FF& '
setFF( +
;FF+ ,
}FF- .
publicGG 
intGG 
QuantityGG 
{GG 
getGG !
;GG! "
setGG# &
;GG& '
}GG( )
}HH 
}JJ Ù
eD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\Repository\CaptChaService\CaptchaService.cs
public 
class 
CaptchaService 
{ 
private 
readonly 
IConfiguration #
_configuration$ 2
;2 3
private 
readonly 

HttpClient 
_httpClient  +
;+ ,
public 

CaptchaService 
( 
IConfiguration (
configuration) 6
)6 7
{ 
_configuration 
= 
configuration &
;& '
_httpClient		 
=		 
new		 

HttpClient		 $
(		$ %
)		% &
;		& '
}

 
public 

async 
Task 
< 
bool 
> 
VerifyCaptchaAsync .
(. /
string/ 5
captchaResponse6 E
)E F
{ 
string 
	secretKey 
= 
_configuration )
[) *
$str* =
]= >
;> ?
var 
content 
= 
new !
FormUrlEncodedContent /
(/ 0
new0 3
[3 4
]4 5
{ 	
new 
KeyValuePair 
< 
string #
,# $
string% +
>+ ,
(, -
$str- 5
,5 6
	secretKey7 @
)@ A
,A B
new 
KeyValuePair 
< 
string #
,# $
string% +
>+ ,
(, -
$str- 7
,7 8
captchaResponse9 H
)H I
} 	
)	 

;
 
var 
response 
= 
await 
_httpClient (
.( )
	PostAsync) 2
(2 3
$str3 n
,n o
contentp w
)w x
;x y
var 

jsonString 
= 
await 
response '
.' (
Content( /
./ 0
ReadAsStringAsync0 A
(A B
)B C
;C D
var 
jsonResponse 
= 
JsonSerializer )
.) *
Deserialize* 5
<5 6
CaptchaResponse6 E
>E F
(F G

jsonStringG Q
)Q R
;R S
return 
jsonResponse 
!= 
null #
&&$ &
jsonResponse' 3
.3 4
success4 ;
;; <
} 
private 
class 
CaptchaResponse !
{ 
public 
bool 
success 
{ 
get !
;! "
set# &
;& '
}( )
public   
DateTime   
challenge_ts   $
{  % &
get  ' *
;  * +
set  , /
;  / 0
}  1 2
public!! 
string!! 
hostname!! 
{!!  
get!!! $
;!!$ %
set!!& )
;!!) *
}!!+ ,
}"" 
}## ë
YD:\FPT Course\Summer2024\PRN221\Project\New folder\a\Shop\Repository\AccountRepository.cs
	namespace 	

Repository
 
{ 
public 

class 
AccountRepository "
:# $
IAccountRepository% 7
{ 
public 
async 
Task 
Add 
( 
Account %
pro& )
)) *
=>+ -
await. 3

AccountDAO4 >
.> ?
Instance? G
.G H
AddH K
(K L
proL O
)O P
;P Q
public 
async 
Task 
Delete  
(  !
Account! (
pro) ,
), -
=>. 0
await1 6

AccountDAO7 A
.A B
InstanceB J
.J K
DeleteK Q
(Q R
proR U
)U V
;V W
public 
async 
Task 
< 
Account !
>! "
GetAccountById# 1
(1 2
int2 5
id6 8
)8 9
=>: <
await= B

AccountDAOC M
.M N
InstanceN V
.V W
GetAccountByIdW e
(e f
idf h
)h i
;i j
public 
async 
Task 
< 
IEnumerable %
<% &
Account& -
>- .
>. /
GetAccounts0 ;
(; <
)< =
=>> @
awaitA F

AccountDAOG Q
.Q R
InstanceR Z
.Z [
GetAccounts[ f
(f g
)g h
;h i
public 
async 
Task 
< 
int 
> !
GetTotalAccountsAsync 4
(4 5
)5 6
=>7 9
await: ?

AccountDAO@ J
.J K
InstanceK S
.S T!
GetTotalAccountsAsyncT i
(i j
)j k
;k l
public 
async 
Task 
Update  
(  !
Account! (
pro) ,
), -
=>. 0
await1 6

AccountDAO7 A
.A B
InstanceB J
.J K
UpdateK Q
(Q R
proR U
)U V
;V W
public 
async 
Task 
< 
Account !
>! "
GetAccountByEmail# 4
(4 5
string5 ;
pro< ?
)? @
=>A C
awaitD I

AccountDAOJ T
.T U
InstanceU ]
.] ^
GetAccountByEmail^ o
(o p
prop s
)s t
;t u
public 
async 
Task 
ResetPassword '
(' (
string( .
email/ 4
,4 5
string6 <
newPassword= H
)H I
=>J L
awaitM R

AccountDAOS ]
.] ^
Instance^ f
.f g
ResetPasswordg t
(t u
emailu z
,z {
newPassword	| á
)
á à
;
à â
} 
} 